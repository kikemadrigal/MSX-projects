0001   0000                 output "loader.bin"
0002   0000             
0003   0000 FE              db   0FEh               ; ID archivo binario, siempre hay que poner el mismo 0FEh
0004   0001 00 85           dw   INICIO             ; dirección de inicio
0005   0003 2A CF           dw   FINAL - 1          ; dirección final
0006   0005 06 85           dw   MAIN               ; dircción del programa de ejecución (para cuando pongas r en bload"nombre_programa", r)
0007   0007                 
0008   0007                  
0009   0007              
0010   0007                 org #8500              ; org se utiliza para decirle al z80 en que posición de memoria empieza nuestro programa (es la 33280 en decimal), en hezadecimal sería #8200
0011   8500                     
0012   8500             INICIO: 
0013   8500 00          screen:  db 0
0014   8501 00          game_over:  db 0
0015   8502 00          lives:  db 0
0016   8503 00 00       score:  db 0,0
0017   8505 00          in_game:  db 0
0018   8506             ;esta es la entrada principal
0019   8506             MAIN: 
0020   8506 CD 3C 85        call load_screen_loader_full
0021   8509                 ;le ponemos un pequeño retraso
0022   8509 11 70 00        ld de,#70
0023   850C             wait:     
0024   850C 76              halt
0025   850D 1B              dec de
0026   850E 7A              ld a,d
0027   850F B3              or e
0028   8510 C2 0C 85        jp nz,wait
0029   8513             
0030   8513             
0031   8513             
0032   8513 CD 56 01     	call KILBUF ; limpiamos el buffer, por si vlvemos a empezar
0033   8516 CD CC 00     	call ERAFNK ; kitamos las letras de las teclas función
0034   8519 3E 01           ld a,1
0035   851B 32 AA FC        ld (#fcaa),a; borramos el cursor
0036   851E             
0037   851E 3E 01           ld a,1      ;cambiamos a screen 1 ya que para cargar la pantalla de carga hemos tenido que poner el 2
0038   8520 CD 5F 00        call CHGMOD
0039   8523             
0040   8523 CD BE 85        call show_menu ; mostramos el menu
0041   8526             	;CALL para_cancion
0042   8526             loop_menu: 	
0043   8526 AF          	xor a
0044   8527 CD D8 00    	call GTTRIG
0045   852A             	;GTTRIG devuelve 255 si está presionada y 0 sino lo está
0046   852A FE 00       	cp 0
0047   852C CA 26 85    	jp z, loop_menu
0048   852F CD 92 85    	call set_screen2_16x16
0049   8532 CD 41 00        call DISSCR ;apagamos la pantalla, la encendermos en el main.asm
0050   8535 CD B1 85    	call load_sprites
0051   8538 CD 49 85    	call load_tileset
0052   853B C9          	ret
0053   853C             
0054   853C             load_screen_loader_full: 
0055   853C                 ;ld hl,loader_screen+7;sumamos +7 sin comprensión
0056   853C 21 3A AF        ld hl,loader_screen;saltamos los 7 primeros bytes de la cabecera del bin
0057   853F 11 00 00        ld de,0
0058   8542 01 07 38        ld bc, #3807
0059   8545 CD 5A AE        call depack_VRAM
0060   8548                 ;call LDIRVM
0061   8548 C9              ret
0062   8549             	
0063   8549             load_tileset: 
0064   8549             	;banco 0
0065   8549             	;la rutina LDIRVM necesita haber cargado previamente con de la dirección de inicio de la VRAM.https://sites.google.com/site/multivac7/files-images/TMS9918_VRAMmap_G2_300dpi.png,así es como está formado el VDP en screen 2          
0066   8549 21 36 87    	ld hl, tileset_definition
0067   854C 11 00 00    	ld de, 0 ; aquí es posible utilizar la variable del sistema GRPCGP
0068   854F 01 00 05    	ld bc, 1280  ; son los 8 bytes por 160 tiles que hemos dibujado=1280 bytes
0069   8552 CD 5C 00    	call  LDIRVM 
0070   8555             	;banco 1
0071   8555 21 36 87    	ld hl, tileset_definition
0072   8558 11 00 08    	ld de, 2048
0073   855B 01 00 05    	ld bc, 1280 
0074   855E CD 5C 00    	call  LDIRVM 
0075   8561             	;banco 2
0076   8561 21 36 87    	ld hl, tileset_definition
0077   8564 11 00 10    	ld de, 4096
0078   8567 01 00 05    	ld bc, 1280  
0079   856A CD 5C 00    	call  LDIRVM 
0080   856D             
0081   856D             	;banco 0
0082   856D 21 36 8C    	ld hl, tileset_color
0083   8570 11 00 20        ld de, 8192 ; aquí es posible utilizar la variable del sistema GRPCOL
0084   8573 01 00 05        ld bc, 1280  
0085   8576 CD 5C 00        call  LDIRVM 
0086   8579             	;banco 1
0087   8579 21 36 8C    	ld hl, tileset_color
0088   857C 11 00 28        ld de, 10240  
0089   857F 01 00 05        ld bc, 1280  
0090   8582 CD 5C 00        call  LDIRVM 
0091   8585             	;banco 2
0092   8585 21 36 8C    	ld hl, tileset_color
0093   8588 11 00 30        ld de, 12288  
0094   858B 01 00 05        ld bc, 1280  
0095   858E CD 5C 00        call  LDIRVM 
0096   8591 C9          	ret
0097   8592             
0098   8592             
0099   8592             
0100   8592             set_screen2_16x16: 
0101   8592                 ;poner los colores de tinta, fondo y borde
0102   8592 21 E9 F3    	ld      hl,FORCLR
0103   8595 36 0F       	ld      [hl],15 ;le poneos el 15 en tinta que es el blanco
0104   8597 23          	inc     hl
0105   8598 36 01       	ld      [hl],1 ;le metemos 1 en fondo que es el negro
0106   859A 23          	inc		hl
0107   859B 36 01       	ld		[hl],1 ;en borde también el negro
0108   859D CD 62 00    	call    CHGCLR
0109   85A0             
0110   85A0             	;click off	
0111   85A0 AF          	xor	a		
0112   85A1 32 DB F3    	ld	[CLIKSW],a
0113   85A4             		
0114   85A4             	;screen 2
0115   85A4 3E 02       	ld a,2
0116   85A6 CD 5F 00    	call CHGMOD ;rutina de la bios que cambia el modo de screen
0117   85A9             
0118   85A9             	;sprites no ampliados de 16x16
0119   85A9 06 E2       	ld b,0xe2
0120   85AB 0E 01       	ld c,1
0121   85AD CD 47 00    	call WRTVDP
0122   85B0             
0123   85B0 C9          	ret
0124   85B1             
0125   85B1             load_sprites: 
0126   85B1                 ;hemos dibujado 20 sprites
0127   85B1 21 36 91        ld hl, sprites_definition
0128   85B4 11 00 38        ld de, 14336; #3800, aquí es posible utilizar la variable del sistema GRPPAT
0129   85B7 01 E0 05        ld bc, 32*47; 32 bytes por 47 sprites dibujados
0130   85BA CD 5C 00        call  LDIRVM 
0131   85BD C9          	ret
0132   85BE             
0133   85BE             show_menu: 
0134   85BE 26 05           ld h,5 ;x coordinate
0135   85C0 2E 02           ld l,2  ;y coordinate
0136   85C2 CD C6 00        call POSIT
0137   85C5 21 09 86        ld hl, message_msx_spain_presents
0138   85C8 CD 00 86        call text_mode_print
0139   85CB             
0140   85CB 26 0C           ld h,12 ;x coordinate
0141   85CD 2E 05           ld l,5  ;y coordinate
0142   85CF CD C6 00        call POSIT
0143   85D2 21 1C 86        ld hl, message_disco
0144   85D5 CD 00 86        call text_mode_print
0145   85D8             
0146   85D8 26 01           ld h,1  ;x coordinate
0147   85DA 2E 07           ld l,7  ;y coordinate
0148   85DC CD C6 00        call POSIT
0149   85DF 21 22 86        ld hl, message_description
0150   85E2 CD 00 86        call text_mode_print
0151   85E5             
0152   85E5 26 01           ld h,1  ;x coordinate
0153   85E7 2E 0D           ld l,13  ;y coordinate
0154   85E9 CD C6 00        call POSIT
0155   85EC 21 A1 86        ld hl, message_description_english
0156   85EF CD 00 86        call text_mode_print
0157   85F2             
0158   85F2 26 03           ld h,3  ;x coordinate
0159   85F4 2E 14           ld l,20 ;y coordinate
0160   85F6 CD C6 00        call POSIT
0161   85F9 21 1F 87        ld hl, message_press_any_key_to_start
0162   85FC CD 00 86        call text_mode_print
0163   85FF             
0164   85FF C9              ret
0165   8600             text_mode_print: 
0166   8600 7E              ld  a,(hl)          
0167   8601 A7              and a               
0168   8602 C8              ret z               
0169   8603 CD A2 00        call CHPUT         
0170   8606 23              inc hl              
0171   8607 18 F7           jr text_mode_print   
0172   8609             
0173   8609             
0174   8609             message_msx_spain_presents:  db "MSX spain presents",0
0174   8609 4D535820737061696E2070726573656E747300
0175   861C             message_disco:  db "Disco",0
0175   861C 446973636F00
0176   8622             message_description:  db "Deberas de recoger todas las botellas, 100 botellas suman 1 vida y ligarte a las chicas que veas, despues escapa por la salida",0
0176   8622 44656265726173206465207265636F67657220746F646173206C617320626F74
0176   8642 656C6C61732C2031303020626F74656C6C61732073756D616E20312076696461
0176   8662 2079206C6967617274652061206C617320636869636173207175652076656173
0176   8682 2C20646573707565732065736361706120706F72206C612073616C69646100
0177   86A1             message_description_english:  db "You must collect all the bottles, 100 bottles add up to 1 life and flirt with the girls you see, then escape through the exit",0
0177   86A1 596F75206D75737420636F6C6C65637420616C6C2074686520626F74746C6573
0177   86C1 2C2031303020626F74746C65732061646420757020746F2031206C6966652061
0177   86E1 6E6420666C697274207769746820746865206769726C7320796F75207365652C
0177   8701 207468656E20657363617065207468726F75676820746865206578697400
0178   871F             message_press_any_key_to_start:  db "Press any key to start",0
0178   871F 507265737320616E79206B657920746F20737461727400
0179   8736             
0180   8736             
0181   8736             
0182   8736             ;includes para sjasmplus
0183   8736             	include "src/vars_msxBios.asm"    
0001+  8736             ;ver las instruciones del z80: http://clrhome.org/table/
0002+  8736             ;ver las instrucciones de la bios: https://map.grauw.nl/resources/msxbios.php
0003+  8736             ;ver las instrucciones: https://www.msx.org/wiki/Z80_Assembler_for_Dummies
0004+  8736             
0005+  8736             ; use RST assembler mnemonic to call
0006+  8736             CHKRAM equ 0x00 ; RST 0x00 > Check RAM and sets slot for command area.
0007+  8736             SYNCHR equ 0x08 ; RST	0x08 > Checks if then current character pointed by HL is one desired.
0008+  8736             CHRGTR equ 0x10 ; RST	0x10 > Gets the next character (or token) of the Basic-text
0009+  8736             OUTDO  equ 0x18 ; RST	0x18 > Output to current outputchannel (printer, diskfile, etc.)
0010+  8736             DCOMPR equ 0x20 ; RST	0x20 > Compares HL with DE
0011+  8736             GETYPR equ 0x28 ; RST	0x28 > Returns Type of DAC
0012+  8736             CALLF  equ 0x30 ; RST	0x30 > Executes an interslot call
0013+  8736             KEYINT equ 0x38 ; RST	0x38 > Executes the timer interrupt process routine
0014+  8736             
0015+  8736             ; use CALL assembler mnemonic
0016+  8736             RDSLT  equ 0x000C ; Reads the value of an address in another slot
0017+  8736             WRSLT  equ 0x0014 ; Writes a value to an address in another slot
0018+  8736             CALSLT equ 0x001C ; Executes inter-slot call
0019+  8736             ENASLT equ 0x0024 ; Switches indicated slot at indicated page on perpetual
0020+  8736             
0021+  8736             ; Initialization-routines
0022+  8736             INITIO equ 0x003B ; Initialises the device
0023+  8736             INIFNK equ 0x003E ; Initialises the contents of the function keys
0024+  8736             
0025+  8736             ; VDP routines
0026+  8736             DISSCR equ 0x0041 ; inhibits the screen display
0027+  8736             ENASCR equ 0x0044 ; displays the screen
0028+  8736             WRTVDP equ 0x0047 ; write data in the VDP-register, B  - Data to write, C  - Number of the register
0029+  8736             RDVRM  equ 0x004A ; Reads the content of VRAM
0030+  8736             WRTVRM equ 0x004D ; Writes data in VRAM
0031+  8736             SETRD  equ 0x0050 ; Enable VDP to read
0032+  8736             SETWRT equ 0x0053 ; Enable VDP to write
0033+  8736             FILVRM equ 0x0056 ; fill VRAM with value
0034+  8736             LDIRMV equ 0x0059 ; Block transfer to memory from VRAM
0035+  8736             LDIRVM equ 0x005C ; Block transfer to VRAM from memory
0036+  8736             CHGMOD equ 0x005F ; Switches to given screenmode
0037+  8736             CHGCLR equ 0x0062 ; Changes the screencolors
0038+  8736             CLRSPR equ 0x0069 ; Initialises all sprites
0039+  8736             INITXT equ 0x006C ; Switches to SCREEN 0 (text screen with 40 * 24 characters)
0040+  8736             INIT32 equ 0x006F ; Switches to SCREEN 1 (text screen with 32*24 characters)
0041+  8736             INIGRP equ 0x0072 ; Switches to SCREEN 2 (high resolution screen with 256*192 pixels)
0042+  8736             INIMLT equ 0x0075 ; Switches to SCREEN 3 (multi-color screen 64*48 pixels)
0043+  8736             SETTXT equ 0x0078 ; Switches to VDP in SCREEN 0 mode
0044+  8736             SETT32 equ 0x007B ; Switches VDP in SCREEN mode 1
0045+  8736             SETGRP equ 0x007E ; Switches VDP to SCREEN 2 mode
0046+  8736             SETMLT equ 0x0081 ; Switches VDP to SCREEN 3 mode
0047+  8736             CALPAT equ 0x0084 ; Returns the address of the sprite pattern table
0048+  8736             CALATR equ 0x0087 ; Returns the address of the sprite attribute table
0049+  8736             GSPSIZ equ 0x008A ; Returns current sprite size
0050+  8736             GRPPRT equ 0x008D ; Displays a character on the graphic screen
0051+  8736             
0052+  8736                     
0053+  8736             ; PSG routines
0054+  8736             GICINI equ 0x0090 ; Initialises PSG and sets initial value for the PLAY statement
0055+  8736             WRTPSG equ 0x0093 ; Writes data to PSG-register
0056+  8736             ;Input    : A  - PSG register number
0057+  8736             ;           E  - Data write
0058+  8736             RDPSG  equ 0x0096 ; Reads value from PSG-register
0059+  8736             STRTMS equ 0x0099 ; Tests whether the PLAY statement is being executed as a background task. If not, begins to execute the PLAY statement  */
0060+  8736             
0061+  8736             ; Console routines, rutinas de consola
0062+  8736             CHSNS  equ 0x009C ; Tests the status of the keyboard buffer
0063+  8736             CHGET  equ 0x009F ; One character input (waiting)
0064+  8736             CHPUT  equ 0x00A2 ; Displays one character
0065+  8736             LPTOUT equ 0x00A5 ; Sends one character to printer
0066+  8736             LPTSTT equ 0x00A8 ; Tests printer status
0067+  8736             CNVCHR equ 0x00AB ; tests for the graphic header and transforms the code
0068+  8736             PINLIN equ 0x00AE ; Stores in the specified buffer the character codes input until the return key or STOP key is pressed     */
0069+  8736             INLIN  equ 0x00B1 ; Same as PINLIN except that AUGFLG (#F6AA) is set
0070+  8736             QINLIN equ 0x00B4 ; Prints a questionmark andone space
0071+  8736             BREAKX equ 0x00B7 ; Tests status of CTRL-STOP 
0072+  8736             ISCNTC equ 0x00BA ; Tests status of SHIFT-STOP 
0073+  8736             CKCNTC equ 0x00BD ; Same as ISCNTC. used in Basic
0074+  8736             BEEP   equ 0x00C0 ; generates beep
0075+  8736             BCLS   equ 0x00C3 ; Clears the screen
0076+  8736             POSIT  equ 0x00C6 ; Places the cursor at the specified location
0077+  8736             FNKSB  equ 0x00C9 ; Tests whether the function key display is active (FNKFLG)If so, displays them, otherwise erase them */
0078+  8736             ERAFNK equ 0x00CC ; Erase functionkey display
0079+  8736             DSPFNK equ 0x00CF ; Displays the function keys
0080+  8736             TOTEXT equ 0x00D2 ; Forces the screen to be in the text mode
0081+  8736             
0082+  8736             ; Controller routines                      
0083+  8736             GTSTCK equ 0x00D5 ; Returns the joystick status
0084+  8736             GTTRIG equ 0x00D8 ; Returns current trigger status
0085+  8736             GTPAD  equ 0x00DB ; Returns current touch pad status
0086+  8736             GTPDL  equ 0x00DE ; Returns currenct value of paddle
0087+  8736             
0088+  8736             ; Tape device routines                      
0089+  8736             TAPION equ 0x00E1 ; Reads the header block after turning the cassette motor on
0090+  8736             TAPIN  equ 0x00E4 ; Read data from the tape
0091+  8736             TAPIOF equ 0x00E7 ; Stops reading from the tape
0092+  8736             TAPOON equ 0x00EA ; Turns on the cassette motor and writes the header
0093+  8736             TAPOUT equ 0x00ED ; Writes data on the tape
0094+  8736             TAPOOF equ 0x00F0 ; Stops writing on the tape
0095+  8736             STMOTR equ 0x00F3 ; Sets the cassette motor action
0096+  8736             
0097+  8736             ; Queue routines                      
0098+  8736             LFTQ equ 0x00F6 ; Gives number of bytes in queue
0099+  8736             PUTQ equ 0x00F9 ; Put byte in queue
0100+  8736             
0101+  8736             ; Graphic routines
0102+  8736             ;More info (MSX Assembly Page): http:;map.grauw.nl/resources/msxbios.php                      
0103+  8736             RIGHTC equ 0x00FC ; Shifts screenpixel to the right
0104+  8736             LEFTC  equ 0x00FF ; Shifts screenpixel to the left
0105+  8736             UPC    equ 0x0102 ; Shifts screenpixel up
0106+  8736             TUPC   equ 0x0105 ; Tests whether UPC is possible, if possible, execute UPC
0107+  8736             DOWNC  equ 0x0108 ; Shifts screenpixel down
0108+  8736             TDOWNC equ 0x010B ; Tests whether DOWNC is possible, if possible, execute DOWNC
0109+  8736             SCALXY equ 0x010E ; Scales X and Y coordinates
0110+  8736             MAPXY  equ 0x0111 ; Places cursor at current cursor address
0111+  8736             FETCHC equ 0x0114 ; Gets current cursor addresses mask pattern
0112+  8736             STOREC equ 0x0117 ; Record current cursor addresses mask pattern
0113+  8736             SETATR equ 0x011A ; Set attribute byte
0114+  8736             READC  equ 0x011E ; Reads attribute byte of current screenpixel
0115+  8736             SETC   equ 0x0120 ; Returns currenct screenpixel of specificed attribute byte
0116+  8736             NSETCX equ 0x0123 ; Set horizontal screenpixels
0117+  8736             GTASPC equ 0x0126 ; Gets screen relations
0118+  8736             PNTINI equ 0x0129 ; Initalises the PAINT instruction
0119+  8736             SCANR  equ 0x012C ; Scans screenpixels to the right
0120+  8736             SCANL  equ 0x012F ; Scans screenpixels to the left
0121+  8736             
0122+  8736             ; Graphic routines MSX2
0123+  8736             ;More info (MSX Assembly Page): http:;map.grauw.nl/resources/msxbios.php#msx2bios
0124+  8736             CHKNEW equ 0x0165 ;Tests screen mode > C-flag set if screenmode = 5, 6, 7 or 8
0125+  8736             BIGFIL equ 0x016B ;fill VRAM with value (total VRAM can be reached) HL address, BC length, A data
0126+  8736             NSETRD equ 0x016E ;Enable VDP to read.(with full 16 bits VRAM-address)
0127+  8736             NSTWRT equ 0x0171 ;Enable VDP to write.(with full 16 bits VRAM-address) 
0128+  8736             NRDVRM equ 0x0174 ;Reads VRAM like in RDVRM.(with full 16 bits VRAM-address)
0129+  8736             NWRVRM equ 0x0177 ;Writes to VRAM like in WRTVRM.(with full 16 bits VRAM-address)
0130+  8736             
0131+  8736             
0132+  8736             
0133+  8736             
0134+  8736             
0135+  8736             
0136+  8736                                  
0137+  8736             ; Misc routines
0138+  8736             CLIKSW equ 0xF3DB; para que no se oiga el click que hace al pulsar las teclas
0139+  8736             CHGCAP equ 0x0132 ; Alternates the CAP lamp status
0140+  8736             CHGSND equ 0x0135 ; Alternates the 1-bit sound port status
0141+  8736             RSLREG equ 0x0138 ; Reads the primary slot register
0142+  8736             WSLREG equ 0x013B ; Writes value to the primary slot register
0143+  8736             RDVDP  equ 0x013E ; Reads VDP status register
0144+  8736             SNSMAT equ 0x0141 ; Returns the value of the specified line from the keyboard matrix
0145+  8736             ; 0   1          2           3           4           5           6           7           8       9       10
0146+  8736             ;0    1          2                      4           5           6
0147+  8736             ;1   ; fin grabr ' grabar                                                    Ñ
0148+  8736             ;2                                      \grabar2  DEADfingrabar2 A           B
0149+  8736             ;3 C                        F           G           H
0150+  8736             ;4                          N
0151+  8736             ;5 S                        V                       X                       Z
0152+  8736             ;6SHIFtONTROL    GRAPH      CAPS        CODE
0153+  8736             ;7              ESCAPE                              BS                      RET
0154+  8736             ;8                                               Cursor ^    Cursor v
0155+  8736             PHYDIO equ 0x0144 ; Executes I/O for mass-storage media like diskettes
0156+  8736             FORMAT equ 0x0147 ; Initialises mass-storage media like formatting of diskettes
0157+  8736             ISFLIO equ 0x014A ; Tests if I/O to device is taking place
0158+  8736             OUTDLP equ 0x014E ; Printer output
0159+  8736             GETVCP equ 0x0150 ; Returns pointer to play queue
0160+  8736             GETVC2 equ 0x0153 ; Returns pointer to variable in queue number VOICEN (byte op #FB38)
0161+  8736             KILBUF equ 0x0156 ; Clear keyboard buffer
0162+  8736             CALBAS equ 0x0159 ; Executes inter-slot call to the routine in BASIC interpreter
0163+  8736             
0164+  8736             
0165+  8736             
0166+  8736                     
0167+  8736             
0184   8736             	include "src/vars_msxSystem.asm"    
0001+  8736             ;ver las instrucciones del z80
0002+  8736             ;ver las instruciones del z80: http://clrhome.org/table/
0003+  8736             ;variables del sistema
0004+  8736             ;https://www.msx.org/wiki/System_variables_and_work_area
0005+  8736             
0006+  8736             ;TRANSPARENT  equ  0
0007+  8736             ;BLACK        equ  1
0008+  8736             ;GREEN        equ  2
0009+  8736             ;LIGHT_GREEN  equ  3
0010+  8736             ;DARK_BLUE    equ  4
0011+  8736             ;LIGHT_BLUE   equ  5
0012+  8736             ;DARK_RED     equ  6
0013+  8736             ;CYAN         equ  7
0014+  8736             ;RED          equ  8
0015+  8736             ;LIGHT_RED    equ  9
0016+  8736             ;DARK_YELLOW  equ 10
0017+  8736             ;LIGHT_YELLOW equ 11
0018+  8736             ;DARK_GREEN   equ 12
0019+  8736             ;MAGENTA      equ 13
0020+  8736             ;GRAY         equ 14
0021+  8736             ;GREY         equ 14
0022+  8736             ;WHITE        equ 15
0023+  8736             
0024+  8736             COLOR_TRASPARENTE:  equ 0
0025+  8736             COLOR_NEGRO:  equ 1
0026+  8736             COLOR_VERDE_MEDIO:  equ 2
0027+  8736             COLOR_VERDE_CLARO:  equ 3
0028+  8736             COLOR_AZUL_OSCURO:  equ 4
0029+  8736             COLOR_AZUL_MEDIO:  equ 5
0030+  8736             COLOR_ROJO_OSCURO:  equ 6
0031+  8736             COLOR_AZUL_CLARO: equ 7
0032+  8736             COLOR_ROJO_MEDIO:  equ 8
0033+  8736             COLOR_ROSA:  equ 9
0034+  8736             COLOR_AMARILLO:  equ 10
0035+  8736             COLOR_AMBAR:  equ 11
0036+  8736             COLOR_VERDE_OSCURO:  equ 12
0037+  8736             COLOR_LILA:  equ 13
0038+  8736             COLOR_GRIS:  equ 14
0039+  8736             COLOR_BLANCO:  equ 15
0040+  8736             
0041+  8736             ;Slots
0042+  8736             ;---------
0043+  8736             
0044+  8736             ;SLOTs
0045+  8736             SLOT0 equ #FCC1
0046+  8736             SLOT1 equ #FCC2
0047+  8736             SLOT2 equ #FCC3
0048+  8736             SLOT3 equ #FCC4
0049+  8736             
0050+  8736             ;Interruptions
0051+  8736             ;-------------------
0052+  8736             ;Contiene el valor del reloj del software, cada interrupción del VDP se incrementa en 1
0053+  8736             ;El contenido se puede leer o cambiar mediante la función 'TIME' o la instrucción 'TIME'
0054+  8736             JIFFY  equ 0xFC9E
0055+  8736             
0056+  8736             ;Graphics
0057+  8736             ;-------------------
0058+  8736             gxpos equ 0xfcb3
0059+  8736             gypos equ 0xfcb5
0060+  8736             bios_line equ 0x58C1
0061+  8736             
0062+  8736             
0063+  8736             ;VDP registers
0064+  8736             ;------------------- 
0065+  8736             RG0SAV equ 0xF3DF   ;System saves here the byte written to the register R#00, Used by VDP(0)
0066+  8736             RG1SAV equ 0xF3E0   ;System saves here the byte written to the register R#01, Used by VDP(1)
0067+  8736             RG2SAV equ 0xF3E1   ;System saves here the byte written to the register R#02, Used by VDP(2)
0068+  8736             RG3SAV equ 0xF3E2   ;System saves here the byte written to the register R#03, Used by VDP(3)
0069+  8736             RG4SAV equ 0xF3E3   ;System saves here the byte written to the register R#04, Used by VDP(4)
0070+  8736             RG5SAV equ 0xF3E4   ;System saves here the byte written to the register R#05, Used by VDP(5)
0071+  8736             RG6SAV equ 0xF3E5   ;System saves here the byte written to the register R#06, Used by VDP(6)
0072+  8736             RG7SAV equ 0xF3E6   ;System saves here the byte written to the register R#07.at start, Used by VDP(7)
0073+  8736             STATFL equ 0xF3E7   ;System saves here the byte read from the status register R#00, Used by VDP(0)
0074+  8736             
0075+  8736             ;Screen Parameters
0076+  8736             FORCLR equ 0xF3E9     ;Foreground colour
0077+  8736             BAKCLR equ 0xF3EA     ;Background colour
0078+  8736             BDRCLR equ 0xF3EB     ;Border colour
0079+  8736             LINL40 equ 0xF3AE     ;Screen width per line in SCREEN 0 (Default 39)
0080+  8736             LINL32 equ 0xF3AF     ;Screen width per line in SCREEN 1 (Default 29)
0081+  8736             LINLEN equ 0xF3B0     ;Current screen width per line
0082+  8736             CRTCNT equ 0xF3B1     ;Number of lines of current screen (default 24)
0083+  8736             CLMLST equ 0xF3B2     ;X-location in the case that items are divided by commas in PRINT. (LINLEN-(LINLEN MOD 14)-14)
0084+  8736             TXTNAM equ 0xF3B3     ;SCREEN 0 pattern name tabte address
0085+  8736             TXTCOL equ 0xF3B5     ;SCREEN 0 color table address
0086+  8736             TXTCGP equ 0xF3B7     ;SCREEN 0 Pattern generator table address
0087+  8736             TXTATR equ 0xF3B9     ;Unused
0088+  8736             TXTPAT equ 0xF3BB     ;Unused
0089+  8736             T32NAM equ 0xF3BD     ;SCREEN 1 pattern name table address
0090+  8736             T32COL equ 0xF3BF     ;SCREEN 1 color table address
0091+  8736             T32CGP equ 0xF3C1     ;SCREEN 1 pattern ganarator table address
0092+  8736             T32ATR equ 0xF3C3     ;SCREEN 1 sprite attribute table address
0093+  8736             T32PAT equ 0xF3C5     ;SCREEN 1 sprite generator table address
0094+  8736             GRPNAM equ 0xF3C7     ;SCREEN 2 pattern name table address
0095+  8736             GRPCOL equ 0xF3C9     ;SCREEN 2 color table address
0096+  8736             GRPCGP equ 0xF3CB     ;SCREEN 2 pattern generator table address
0097+  8736             GRPATR equ 0xF3CD     ;SCREEN 2 sprite attribute table address
0098+  8736             GRPPAT equ 0xF3CF     ;SCREEN 2 sprite generator table address
0099+  8736             MLTNAM equ 0xF3D1     ;SCREEN 3 pattern name tabte address
0100+  8736             MLTCOL equ 0xF3D3     ;SCREEN 3 color table address
0101+  8736             MLTCGP equ 0xF3D5     ;SCREEN 3 pattern generator table address
0102+  8736             MLTATR equ 0xF3D7     ;SCREEN 3 sprite attribute table address
0103+  8736             MLTPAT equ 0xF3D9     ;SCREEN 3 sprite generator table address
0104+  8736             TRCFLG equ 0xF7C4     ;Tracing flag. 0 = No tracing; Other = Tracing in progress
0105+  8736             CGPNT  equ 0xF91F     ;Location of the character font used to initialise screen 
0106+  8736                                   ;CGPNT = Slot ID
0107+  8736                                   ;CGPNT+1 = Address
0108+  8736             NAMBAS	equ 0xF922    ;Current pattern name table address
0109+  8736             CGPBAS	equ 0xF924    ;Current pattern generator table address
0110+  8736             PATBAS	equ 0xF926    ;Current sprite generator table address
0111+  8736             ATRBAS	equ 0xF928    ;Current sprite attribute table address
0112+  8736             CLOC	equ 0xF92A    ;Graphic cursor location
0113+  8736             CMASK	equ 0xF92C    ;Graphic cursor mask (SCREEN 2 to 4) or ordinate (SCREEN 5 to 12)
0114+  8736             DPPAGE	equ 0xFAF5    ;Displayed page number. (MSX2~)Modified by SETPAGE X
0115+  8736             ACPAGE	equ 0xFAF6    ;Destination page number. (MSX2~)Modified by SETPAGE ,X
0116+  8736             MODE	equ 0xFAFC    ;Flag for screen mode
0117+  8736                                 ;bit 7: 1 = conversion to Katakana; 0 = conversion to Hiragana. (MSX2+~)
0118+  8736                                 ;bit 6: 1 if Kanji ROM level 2. (MSX2+~)
0119+  8736                                 ;bit 5: 0/1 to draw in RGB / YJK mode SCREEN 10 or 11. (MSX2+~)
0120+  8736                                 ;bit 4: 0/1 to limit the Y coordinate to 211/255. (MSX2+~)
0121+  8736                                 ;bit 3: 1 to apply the mask in SCREEN 0~3
0122+  8736                                 ;bits 1-2: VRAM size
0123+  8736                                 ;	   00 for 16kB
0124+  8736                                 ;	   01 for 64kB
0125+  8736                                 ;	   10 for 128kB
0126+  8736                                 ;	   11 for 192kB
0127+  8736                                 ;bit 0: 1 if the conversion of Romaji to Kana is possible. (MSX2~)
0128+  8736             LINWRK	equ 0xFC18    ;40	Work area for screen management
0129+  8736             PATWRK	equ 0xFC40    ;8	Returned character pattern by the routine GETPAT
0130+  8736             GRPHED	equ 0xFCA6    ;1	Heading for the output of graphic characters
0131+  8736             SCRMOD	equ 0xFCAF    ;1	Screen mode
0132+  8736             OLDSCR	equ 0xFCB0    ;1	Old screen mode
0133+  8736             NORUSE	equ 0xFAFD    ;1	Used by KANJI-ROM for rendering KANJI fonts in graphic modes. (MSX2~)
0134+  8736                                 ;bit 7 Don't return to textmode
0135+  8736                                 ;bit 6 if 1 and F7F4h (DECCNT)=0, read SHIFT status ???
0136+  8736                                 ;bit 5 Disable some functinality
0137+  8736                                 ;bit 4 Not in use	
0138+  8736                                 ;bit 3 color 0 = Transparent
0139+  8736                                 ;bit 0-2: Logical operation on kanji font draw
0140+  8736                                 ;	  0 for PSET
0141+  8736                                 ;	  1 for AND
0142+  8736                                 ;	  2 for OR
0143+  8736                                 ;	  3 for XOR
0144+  8736                                 ;	  4 for NOT
0145+  8736             LOGOPR  equ 0xFB02        ;1	Logical operation code. (MSX2~)
0146+  8736             GXPOS	equ 0xFCB3        ;2	X-position of graphic cursor
0147+  8736             GYPOS	equ 0xFCB5        ;2	Y-position of graphic cursor
0148+  8736             GRPACX  equ 0xFCB7        ;2	X Graphics Accumulator, posicionar cursor en modo gráfico    
0149+  8736             GRPACY  equ 0xFCB9        ;2	Y Graphics Accumulator, posicionar cursor en modo gráfico    
0150+  8736             
0185   8736             	include "src/tileset-definition.asm"
0001+  8736             tileset_definition: 	
0002+  8736             	db 0,0,0,0,0,0,0,0
0002+  8736 0000000000000000
0003+  873E             	db 255,255,255,255,255,255,255,255
0003+  873E FFFFFFFFFFFFFFFF
0004+  8746             	db 0,0,0,0,255,255,255,255
0004+  8746 00000000FFFFFFFF
0005+  874E             	db 0,0,0,0,0,0,255,255
0005+  874E 000000000000FFFF
0006+  8756             	db 1,3,7,15,31,63,127,255
0006+  8756 0103070F1F3F7FFF
0007+  875E             	db 128,192,224,240,248,252,254,255
0007+  875E 80C0E0F0F8FCFEFF
0008+  8766             	db 255,255,255,255,255,255,255,255
0008+  8766 FFFFFFFFFFFFFFFF
0009+  876E             	db 0,0,0,0,255,255,255,255
0009+  876E 00000000FFFFFFFF
0010+  8776             	db 0,0,0,0,0,0,255,255
0010+  8776 000000000000FFFF
0011+  877E             	db 1,3,7,15,31,63,127,255
0011+  877E 0103070F1F3F7FFF
0012+  8786             	db 128,192,224,240,248,252,254,255
0012+  8786 80C0E0F0F8FCFEFF
0013+  878E             	db 255,255,255,255,255,255,255,255
0013+  878E FFFFFFFFFFFFFFFF
0014+  8796             	db 0,0,0,0,255,255,255,255
0014+  8796 00000000FFFFFFFF
0015+  879E             	db 0,0,0,0,0,0,255,255
0015+  879E 000000000000FFFF
0016+  87A6             	db 1,3,7,15,31,63,127,255
0016+  87A6 0103070F1F3F7FFF
0017+  87AE             	db 128,192,224,240,248,252,254,1
0017+  87AE 80C0E0F0F8FCFE01
0018+  87B6             	db 255,255,255,255,255,255,255,255
0018+  87B6 FFFFFFFFFFFFFFFF
0019+  87BE             	db 0,0,0,0,255,255,255,255
0019+  87BE 00000000FFFFFFFF
0020+  87C6             	db 0,0,0,0,0,0,255,255
0020+  87C6 000000000000FFFF
0021+  87CE             	db 1,3,7,15,31,63,127,255
0021+  87CE 0103070F1F3F7FFF
0022+  87D6             	db 128,192,224,240,248,252,254,255
0022+  87D6 80C0E0F0F8FCFEFF
0023+  87DE             	db 255,255,255,255,255,255,255,255
0023+  87DE FFFFFFFFFFFFFFFF
0024+  87E6             	db 0,0,0,0,193,255,255,255
0024+  87E6 00000000C1FFFFFF
0025+  87EE             	db 0,0,0,0,0,0,255,255
0025+  87EE 000000000000FFFF
0026+  87F6             	db 1,3,7,15,31,63,127,255
0026+  87F6 0103070F1F3F7FFF
0027+  87FE             	db 128,192,224,240,248,252,254,255
0027+  87FE 80C0E0F0F8FCFEFF
0028+  8806             	db 255,255,255,255,255,255,255,255
0028+  8806 FFFFFFFFFFFFFFFF
0029+  880E             	db 0,0,0,0,255,255,255,255
0029+  880E 00000000FFFFFFFF
0030+  8816             	db 0,0,0,0,0,0,255,255
0030+  8816 000000000000FFFF
0031+  881E             	db 1,3,7,15,31,63,127,255
0031+  881E 0103070F1F3F7FFF
0032+  8826             	db 128,192,224,240,248,252,254,255
0032+  8826 80C0E0F0F8FCFEFF
0033+  882E             	db 0,0,0,0,0,0,0,0
0033+  882E 0000000000000000
0034+  8836             	db 255,129,129,129,129,129,129,255
0034+  8836 FF818181818181FF
0035+  883E             	db 0,127,127,127,127,127,127,127
0035+  883E 007F7F7F7F7F7F7F
0036+  8846             	db 254,254,254,254,254,254,254,0
0036+  8846 FEFEFEFEFEFEFE00
0037+  884E             	db 255,255,255,255,255,255,255,255
0037+  884E FFFFFFFFFFFFFFFF
0038+  8856             	db 255,255,255,255,255,255,255,255
0038+  8856 FFFFFFFFFFFFFFFF
0039+  885E             	db 0,127,127,127,127,127,127,127
0039+  885E 007F7F7F7F7F7F7F
0040+  8866             	db 254,254,254,254,254,254,254,0
0040+  8866 FEFEFEFEFEFEFE00
0041+  886E             	db 63,96,192,128,64,79,70,79
0041+  886E 3F60C080404F464F
0042+  8876             	db 224,48,12,4,4,132,196,236
0042+  8876 E0300C040484C4EC
0043+  887E             	db 31,48,96,64,75,10,11,114
0043+  887E 1F3060404B0A0B72
0044+  8886             	db 224,56,8,8,96,232,200,6
0044+  8886 E038080860E8C806
0045+  888E             	db 127,192,128,143,205,3,196,199
0045+  888E 7FC0808FCD03C4C7
0046+  8896             	db 240,24,8,8,136,200,200,134
0046+  8896 F018080888C8C886
0047+  889E             	db 63,64,128,141,207,73,79,32
0047+  889E 3F40808DCF494F20
0048+  88A6             	db 224,24,4,132,196,132,140,36
0048+  88A6 E0180484C4848C24
0049+  88AE             	db 63,96,204,26,159,205,109,63
0049+  88AE 3F60CC1A9FCD6D3F
0050+  88B6             	db 240,56,192,220,188,200,64,112
0050+  88B6 F038C0DCBCC84070
0051+  88BE             	db 63,96,95,127,47,47,47,2
0051+  88BE 3F605F7F2F2F2F02
0052+  88C6             	db 240,56,224,240,240,240,232,160
0052+  88C6 F038E0F0F0F0E8A0
0053+  88CE             	db 0,63,96,64,3,37,21,25
0053+  88CE 003F604003251519
0054+  88D6             	db 0,240,8,8,128,136,200,128
0054+  88D6 00F008088088C880
0055+  88DE             	db 255,128,128,128,128,128,128,128
0055+  88DE FF80808080808080
0056+  88E6             	db 255,1,1,1,1,1,1,1
0056+  88E6 FF01010101010101
0057+  88EE             	db 255,1,143,1,1,1,1,1
0057+  88EE FF018F0101010101
0058+  88F6             	db 255,60,36,0,36,60,0,126
0058+  88F6 FF3C2400243C007E
0059+  88FE             	db 24,24,0,24,60,66,255,255
0059+  88FE 181800183C42FFFF
0060+  8906             	db 0,129,60,60,24,24,60,126
0060+  8906 00813C3C18183C7E
0061+  890E             	db 0,0,0,255,129,195,126,60
0061+  890E 000000FF81C37E3C
0062+  8916             	db 60,126,255,129,255,66,126,60
0062+  8916 3C7EFF81FF427E3C
0063+  891E             	db 24,24,24,60,255,127,126,60
0063+  891E 1818183CFF7F7E3C
0064+  8926             	db 56,60,126,36,8,129,195,231
0064+  8926 383C7E240881C3E7
0065+  892E             	db 255,8,8,8,8,8,8,8
0065+  892E FF08080808080808
0066+  8936             	db 255,255,255,255,255,255,255,255
0066+  8936 FFFFFFFFFFFFFFFF
0067+  893E             	db 255,255,255,255,255,255,255,255
0067+  893E FFFFFFFFFFFFFFFF
0068+  8946             	db 255,255,255,255,255,255,255,255
0068+  8946 FFFFFFFFFFFFFFFF
0069+  894E             	db 255,255,255,255,255,255,255,255
0069+  894E FFFFFFFFFFFFFFFF
0070+  8956             	db 255,255,255,255,255,255,255,255
0070+  8956 FFFFFFFFFFFFFFFF
0071+  895E             	db 0,0,0,0,0,0,0,0
0071+  895E 0000000000000000
0072+  8966             	db 0,0,0,0,0,0,0,0
0072+  8966 0000000000000000
0073+  896E             	db 63,91,95,181,192,96,51,97
0073+  896E 3F5B5FB5C0603361
0074+  8976             	db 34,218,234,202,112,4,8,136
0074+  8976 22DAEACA70040888
0075+  897E             	db 102,64,0,64,96,51,97,65
0075+  897E 6640004060336141
0076+  8986             	db 2,2,2,2,14,8,136,248
0076+  8986 020202020E0888F8
0077+  898E             	db 71,3,48,64,96,51,97,65
0077+  898E 4703304060336141
0078+  8996             	db 130,2,10,2,4,8,136,248
0078+  8996 82020A02040888F8
0079+  899E             	db 65,70,51,7,111,51,96,107
0079+  899E 414633076F33606B
0080+  89A6             	db 162,226,40,224,164,200,8,152
0080+  89A6 A2E228E0A4C80898
0081+  89AE             	db 36,24,48,67,104,59,99,67
0081+  89AE 24183043683B6343
0082+  89B6             	db 240,240,104,140,192,80,16,240
0082+  89B6 F0F0688CC05010F0
0083+  89BE             	db 24,121,83,4,12,51,33,63
0083+  89BE 187953040C33213F
0084+  89C6             	db 16,24,8,64,96,8,136,248
0084+  89C6 10180840600888F8
0085+  89CE             	db 49,35,19,96,48,25,49,63
0085+  89CE 312313603019313F
0086+  89D6             	db 2,10,10,6,4,136,136,248
0086+  89D6 020A0A06048888F8
0087+  89DE             	db 0,0,0,0,0,0,0,0
0087+  89DE 0000000000000000
0088+  89E6             	db 0,56,68,76,16,100,68,56
0088+  89E6 0038444C10644438
0089+  89EE             	db 0,12,4,4,0,4,4,4
0089+  89EE 000C040400040404
0090+  89F6             	db 0,28,2,2,28,32,32,60
0090+  89F6 001C02021C20203C
0091+  89FE             	db 0,28,2,2,12,2,2,28
0091+  89FE 001C02020C02021C
0092+  8A06             	db 0,34,34,34,28,2,2,2
0092+  8A06 002222221C020202
0093+  8A0E             	db 0,28,32,32,28,2,2,28
0093+  8A0E 001C20201C02021C
0094+  8A16             	db 0,28,32,32,28,34,34,28
0094+  8A16 001C20201C22221C
0095+  8A1E             	db 0,28,2,2,0,2,2,2
0095+  8A1E 001C020200020202
0096+  8A26             	db 0,28,34,34,28,34,34,28
0096+  8A26 001C22221C22221C
0097+  8A2E             	db 0,28,34,34,28,2,2,28
0097+  8A2E 001C22221C02021C
0098+  8A36             	db 0,56,68,68,56,68,68,68
0098+  8A36 0038444438444444
0099+  8A3E             	db 0,120,68,68,56,68,68,120
0099+  8A3E 0078444438444478
0100+  8A46             	db 0,56,64,64,0,64,64,56
0100+  8A46 0038404000404038
0101+  8A4E             	db 0,120,68,68,0,68,68,120
0101+  8A4E 0078444400444478
0102+  8A56             	db 0,56,64,64,56,64,64,56
0102+  8A56 0038404038404038
0103+  8A5E             	db 0,56,64,64,56,64,64,64
0103+  8A5E 0038404038404040
0104+  8A66             	db 0,56,64,64,12,68,68,56
0104+  8A66 003840400C444438
0105+  8A6E             	db 0,68,68,68,56,68,68,68
0105+  8A6E 0044444438444444
0106+  8A76             	db 0,16,16,16,0,16,16,16
0106+  8A76 0010101000101010
0107+  8A7E             	db 0,4,4,4,0,68,68,56
0107+  8A7E 0004040400444438
0108+  8A86             	db 0,68,72,80,56,68,68,68
0108+  8A86 0044485038444444
0109+  8A8E             	db 0,32,32,32,0,32,32,28
0109+  8A8E 002020200020201C
0110+  8A96             	db 0,56,84,84,0,68,68,68
0110+  8A96 0038545400444444
0111+  8A9E             	db 0,100,84,76,0,68,68,68
0111+  8A9E 0064544C00444444
0112+  8AA6             	db 0,56,68,68,0,68,68,56
0112+  8AA6 0038444400444438
0113+  8AAE             	db 0,56,68,68,56,64,64,64
0113+  8AAE 0038444438404040
0114+  8AB6             	db 0,56,68,68,0,68,72,52
0114+  8AB6 0038444400444834
0115+  8ABE             	db 0,56,68,68,56,80,72,68
0115+  8ABE 0038444438504844
0116+  8AC6             	db 0,60,64,64,56,4,4,120
0116+  8AC6 003C404038040478
0117+  8ACE             	db 0,124,16,16,0,16,16,16
0117+  8ACE 007C101000101010
0118+  8AD6             	db 0,68,68,68,0,68,68,56
0118+  8AD6 0044444400444438
0119+  8ADE             	db 0,68,68,68,8,80,96,64
0119+  8ADE 0044444408506040
0120+  8AE6             	db 0,68,68,68,0,84,84,56
0120+  8AE6 0044444400545438
0121+  8AEE             	db 0,68,68,40,16,40,68,68
0121+  8AEE 0044442810284444
0122+  8AF6             	db 0,68,68,68,56,4,4,56
0122+  8AF6 0044444438040438
0123+  8AFE             	db 0,60,4,8,16,32,64,120
0123+  8AFE 003C040810204078
0124+  8B06             	db 0,0,3,15,31,127,255,127
0124+  8B06 0000030F1F7FFF7F
0125+  8B0E             	db 0,0,192,201,231,254,255,254
0125+  8B0E 0000C0C9E7FEFFFE
0126+  8B16             	db 0,0,0,0,3,7,15,31
0126+  8B16 0000000003070F1F
0127+  8B1E             	db 0,0,0,0,192,240,240,248
0127+  8B1E 00000000C0F0F0F8
0128+  8B26             	db 0,0,0,0,60,110,222,191
0128+  8B26 000000003C6EDEBF
0129+  8B2E             	db 0,0,0,60,126,127,255,255
0129+  8B2E 0000003C7E7FFFFF
0130+  8B36             	db 128,156,0,128,0,128,128,148
0130+  8B36 809C008000808094
0131+  8B3E             	db 128,157,135,142,145,132,133,141
0131+  8B3E 809D878E9184858D
0132+  8B46             	db 0,98,11,35,131,35,35,98
0132+  8B46 00620B2383232362
0133+  8B4E             	db 0,74,254,255,254,255,254,122
0133+  8B4E 004AFEFFFEFFFE7A
0134+  8B56             	db 0,31,63,192,63,63,192,63
0134+  8B56 001F3FC03F3FC03F
0135+  8B5E             	db 226,2,243,243,243,243,3,32
0135+  8B5E E202F3F3F3F30320
0136+  8B66             	db 0,6,254,254,254,246,254,254
0136+  8B66 0006FEFEFEF6FEFE
0137+  8B6E             	db 0,73,1,64,0,8,74,34
0137+  8B6E 0049014000084A22
0138+  8B76             	db 0,39,78,15,139,9,14,69
0138+  8B76 00274E0F8B090E45
0139+  8B7E             	db 0,185,205,26,38,16,138,24
0139+  8B7E 00B9CD1A26108A18
0140+  8B86             	db 0,128,8,128,128,0,0,92
0140+  8B86 008008808000005C
0141+  8B8E             	db 0,133,159,143,151,155,158,7
0141+  8B8E 00859F8F979B9E07
0142+  8B96             	db 0,241,251,251,251,1,251,251
0142+  8B96 00F1FBFBFB01FBFB
0143+  8B9E             	db 0,32,10,4,239,120,8,70
0143+  8B9E 00200A04EF780846
0144+  8BA6             	db 107,255,95,87,127,107,127,127
0144+  8BA6 6BFF5F577F6B7F7F
0145+  8BAE             	db 39,63,47,45,63,63,63,189
0145+  8BAE 273F2F2D3F3F3FBD
0146+  8BB6             	db 128,10,31,224,31,31,31,10
0146+  8BB6 800A1FE01F1F1F0A
0147+  8BBE             	db 7,239,233,238,239,239,239,239
0147+  8BBE 07EFE9EEEFEFEFEF
0148+  8BC6             	db 194,224,249,250,103,167,199,5
0148+  8BC6 C2E0F9FA67A7C705
0149+  8BCE             	db 3,147,19,19,19,139,19,249
0149+  8BCE 03931313138B13F9
0150+  8BD6             	db 160,252,252,130,252,248,248,252
0150+  8BD6 A0FCFC82FCF8F8FC
0151+  8BDE             	db 0,141,38,113,58,68,17,138
0151+  8BDE 008D26713A44118A
0152+  8BE6             	db 0,126,126,126,126,126,126,0
0152+  8BE6 007E7E7E7E7E7E00
0153+  8BEE             	db 0,127,94,94,126,126,126,0
0153+  8BEE 007F5E5E7E7E7E00
0154+  8BF6             	db 0,192,128,128,128,128,194,4
0154+  8BF6 00C080808080C204
0155+  8BFE             	db 0,126,126,126,126,126,127,0
0155+  8BFE 007E7E7E7E7E7F00
0156+  8C06             	db 63,63,63,48,54,54,54,54
0156+  8C06 3F3F3F3036363636
0157+  8C0E             	db 254,130,170,214,214,170,198,198
0157+  8C0E FE82AAD6D6AAC6C6
0158+  8C16             	db 31,31,31,31,15,15,3,0
0158+  8C16 1F1F1F1F0F0F0300
0159+  8C1E             	db 248,248,248,248,240,240,192,0
0159+  8C1E F8F8F8F8F0F0C000
0160+  8C26             	db 191,255,255,127,63,31,15,7
0160+  8C26 BFFFFF7F3F1F0F07
0161+  8C2E             	db 255,255,254,252,248,240,224,192
0161+  8C2E FFFFFEFCF8F0E0C0
0186   8C36             	include "src/tileset-color.asm"
0001+  8C36             tileset_color: 	
0002+  8C36             	db 17,17,17,17,17,17,17,17
0002+  8C36 1111111111111111
0003+  8C3E             	db 209,209,209,209,209,209,209,209
0003+  8C3E D1D1D1D1D1D1D1D1
0004+  8C46             	db 209,209,209,209,209,209,209,209
0004+  8C46 D1D1D1D1D1D1D1D1
0005+  8C4E             	db 209,209,209,209,209,209,209,209
0005+  8C4E D1D1D1D1D1D1D1D1
0006+  8C56             	db 209,209,209,209,209,209,209,209
0006+  8C56 D1D1D1D1D1D1D1D1
0007+  8C5E             	db 209,209,209,209,209,209,209,209
0007+  8C5E D1D1D1D1D1D1D1D1
0008+  8C66             	db 129,129,129,129,129,129,129,129
0008+  8C66 8181818181818181
0009+  8C6E             	db 129,129,129,129,129,129,129,129
0009+  8C6E 8181818181818181
0010+  8C76             	db 129,129,129,129,129,129,129,129
0010+  8C76 8181818181818181
0011+  8C7E             	db 129,129,129,129,129,129,129,129
0011+  8C7E 8181818181818181
0012+  8C86             	db 129,129,129,129,129,129,129,129
0012+  8C86 8181818181818181
0013+  8C8E             	db 113,113,113,113,113,113,113,113
0013+  8C8E 7171717171717171
0014+  8C96             	db 113,113,113,113,113,113,113,113
0014+  8C96 7171717171717171
0015+  8C9E             	db 113,113,113,113,113,113,113,113
0015+  8C9E 7171717171717171
0016+  8CA6             	db 113,113,113,113,113,113,113,113
0016+  8CA6 7171717171717171
0017+  8CAE             	db 113,113,113,113,113,113,113,231
0017+  8CAE 71717171717171E7
0018+  8CB6             	db 81,81,81,81,81,81,81,81
0018+  8CB6 5151515151515151
0019+  8CBE             	db 81,81,81,81,81,81,81,81
0019+  8CBE 5151515151515151
0020+  8CC6             	db 81,81,81,81,81,81,81,81
0020+  8CC6 5151515151515151
0021+  8CCE             	db 81,81,81,81,81,81,81,81
0021+  8CCE 5151515151515151
0022+  8CD6             	db 81,81,81,81,81,81,81,81
0022+  8CD6 5151515151515151
0023+  8CDE             	db 49,49,49,49,49,49,49,49
0023+  8CDE 3131313131313131
0024+  8CE6             	db 49,49,49,49,50,50,50,50
0024+  8CE6 3131313132323232
0025+  8CEE             	db 17,17,17,17,17,17,49,49
0025+  8CEE 1111111111113131
0026+  8CF6             	db 49,49,49,49,49,49,49,49
0026+  8CF6 3131313131313131
0027+  8CFE             	db 49,49,49,49,49,49,49,49
0027+  8CFE 3131313131313131
0028+  8D06             	db 225,225,225,225,225,225,225,225
0028+  8D06 E1E1E1E1E1E1E1E1
0029+  8D0E             	db 225,225,225,225,225,225,225,225
0029+  8D0E E1E1E1E1E1E1E1E1
0030+  8D16             	db 225,225,225,225,225,225,225,225
0030+  8D16 E1E1E1E1E1E1E1E1
0031+  8D1E             	db 225,225,225,225,225,225,225,225
0031+  8D1E E1E1E1E1E1E1E1E1
0032+  8D26             	db 225,225,225,225,225,225,225,225
0032+  8D26 E1E1E1E1E1E1E1E1
0033+  8D2E             	db 225,225,225,225,225,225,225,225
0033+  8D2E E1E1E1E1E1E1E1E1
0034+  8D36             	db 145,154,154,154,154,154,154,154
0034+  8D36 919A9A9A9A9A9A9A
0035+  8D3E             	db 17,241,241,241,241,241,241,241
0035+  8D3E 11F1F1F1F1F1F1F1
0036+  8D46             	db 241,241,241,241,241,241,241,241
0036+  8D46 F1F1F1F1F1F1F1F1
0037+  8D4E             	db 241,241,241,241,241,241,241,241
0037+  8D4E F1F1F1F1F1F1F1F1
0038+  8D56             	db 161,161,161,161,161,161,161,161
0038+  8D56 A1A1A1A1A1A1A1A1
0039+  8D5E             	db 161,161,161,161,161,161,161,161
0039+  8D5E A1A1A1A1A1A1A1A1
0040+  8D66             	db 161,161,161,161,161,161,161,161
0040+  8D66 A1A1A1A1A1A1A1A1
0041+  8D6E             	db 241,225,225,241,225,225,177,241
0041+  8D6E F1E1E1F1E1E1B1F1
0042+  8D76             	db 241,225,225,241,241,225,225,225
0042+  8D76 F1E1E1F1F1E1E1E1
0043+  8D7E             	db 241,225,225,241,225,129,129,241
0043+  8D7E F1E1E1F1E18181F1
0044+  8D86             	db 241,241,241,241,97,161,177,225
0044+  8D86 F1F1F1F161A1B1E1
0045+  8D8E             	db 225,225,241,225,225,97,225,225
0045+  8D8E E1E1F1E1E161E1E1
0046+  8D96             	db 225,225,241,241,225,177,145,225
0046+  8D96 E1E1F1F1E1B191E1
0047+  8D9E             	db 241,225,241,177,225,145,225,225
0047+  8D9E F1E1F1B1E191E1E1
0048+  8DA6             	db 241,241,225,225,177,177,225,225
0048+  8DA6 F1F1E1E1B1B1E1E1
0049+  8DAE             	db 225,241,225,209,161,241,225,225
0049+  8DAE E1F1E1D1A1F1E1E1
0050+  8DB6             	db 225,225,97,225,225,145,97,209
0050+  8DB6 E1E161E1E19161D1
0051+  8DBE             	db 225,225,161,161,177,145,145,129
0051+  8DBE E1E1A1A1B1919181
0052+  8DC6             	db 225,225,161,161,161,161,225,65
0052+  8DC6 E1E1A1A1A1A1E141
0053+  8DCE             	db 65,225,225,241,97,225,225,161
0053+  8DCE 41E1E1F161E1E1A1
0054+  8DD6             	db 161,225,241,225,97,225,225,97
0054+  8DD6 A1E1F1E161E1E161
0055+  8DDE             	db 129,137,137,137,137,137,137,137
0055+  8DDE 8189898989898989
0056+  8DE6             	db 137,137,137,137,137,137,137,137
0056+  8DE6 8989898989898989
0057+  8DEE             	db 137,137,145,137,137,137,137,137
0057+  8DEE 8989918989898989
0058+  8DF6             	db 49,131,131,131,131,131,131,49
0058+  8DF6 3183838383838331
0059+  8DFE             	db 49,49,49,49,49,56,56,56
0059+  8DFE 3131313131383838
0060+  8E06             	db 56,135,113,129,129,129,129,129
0060+  8E06 3887718181818181
0061+  8E0E             	db 129,129,129,129,135,135,129,129
0061+  8E0E 8181818187878181
0062+  8E16             	db 129,129,129,143,143,143,129,129
0062+  8E16 8181818F8F8F8181
0063+  8E1E             	db 129,129,129,129,129,129,129,129
0063+  8E1E 8181818181818181
0064+  8E26             	db 122,122,122,231,231,167,167,167
0064+  8E26 7A7A7AE7E7A7A7A7
0065+  8E2E             	db 129,122,122,122,122,122,122,122
0065+  8E2E 817A7A7A7A7A7A7A
0066+  8E36             	db 209,209,209,209,209,209,209,209
0066+  8E36 D1D1D1D1D1D1D1D1
0067+  8E3E             	db 81,81,81,81,81,81,81,81
0067+  8E3E 5151515151515151
0068+  8E46             	db 97,97,97,97,97,97,97,97
0068+  8E46 6161616161616161
0069+  8E4E             	db 113,113,113,113,113,113,113,113
0069+  8E4E 7171717171717171
0070+  8E56             	db 33,33,33,33,33,33,33,33
0070+  8E56 2121212121212121
0071+  8E5E             	db 33,33,33,33,33,33,33,33
0071+  8E5E 2121212121212121
0072+  8E66             	db 33,33,33,33,33,33,33,33
0072+  8E66 2121212121212121
0073+  8E6E             	db 225,225,225,225,225,225,225,241
0073+  8E6E E1E1E1E1E1E1E1F1
0074+  8E76             	db 254,225,225,225,81,241,241,225
0074+  8E76 FEE1E1E151F1F1E1
0075+  8E7E             	db 161,225,225,225,225,225,241,254
0075+  8E7E A1E1E1E1E1E1F1FE
0076+  8E86             	db 225,225,225,225,241,241,225,225
0076+  8E86 E1E1E1E1F1F1E1E1
0077+  8E8E             	db 225,97,225,225,225,225,241,254
0077+  8E8E E161E1E1E1E1F1FE
0078+  8E96             	db 225,225,225,225,241,241,225,225
0078+  8E96 E1E1E1E1F1F1E1E1
0079+  8E9E             	db 225,225,97,129,225,225,225,225
0079+  8E9E E1E16181E1E1E1E1
0080+  8EA6             	db 225,241,97,97,225,225,241,225
0080+  8EA6 E1F16161E1E1F1E1
0081+  8EAE             	db 239,209,239,225,225,225,225,254
0081+  8EAE EFD1EFE1E1E1E1FE
0082+  8EB6             	db 209,209,209,241,65,161,225,225
0082+  8EB6 D1D1D1F141A1E1E1
0083+  8EBE             	db 97,225,225,97,97,241,225,225
0083+  8EBE 61E1E16161F1E1E1
0084+  8EC6             	db 97,225,225,97,97,241,225,225
0084+  8EC6 61E1E16161F1E1E1
0085+  8ECE             	db 225,225,97,225,225,225,225,225
0085+  8ECE E1E161E1E1E1E1E1
0086+  8ED6             	db 225,225,225,225,241,225,225,225
0086+  8ED6 E1E1E1E1F1E1E1E1
0087+  8EDE             	db 225,225,225,225,225,225,225,225
0087+  8EDE E1E1E1E1E1E1E1E1
0088+  8EE6             	db 225,49,49,49,49,49,49,49
0088+  8EE6 E131313131313131
0089+  8EEE             	db 49,49,49,49,49,49,49,49
0089+  8EEE 3131313131313131
0090+  8EF6             	db 49,49,49,49,49,49,49,49
0090+  8EF6 3131313131313131
0091+  8EFE             	db 49,49,49,49,49,49,49,49
0091+  8EFE 3131313131313131
0092+  8F06             	db 49,49,49,49,49,49,49,49
0092+  8F06 3131313131313131
0093+  8F0E             	db 49,49,49,49,49,49,49,49
0093+  8F0E 3131313131313131
0094+  8F16             	db 49,49,49,49,49,49,49,49
0094+  8F16 3131313131313131
0095+  8F1E             	db 49,49,49,49,49,49,49,49
0095+  8F1E 3131313131313131
0096+  8F26             	db 49,49,49,49,49,49,49,49
0096+  8F26 3131313131313131
0097+  8F2E             	db 49,49,49,49,49,49,49,49
0097+  8F2E 3131313131313131
0098+  8F36             	db 49,49,49,49,49,49,49,49
0098+  8F36 3131313131313131
0099+  8F3E             	db 49,49,49,49,49,49,49,49
0099+  8F3E 3131313131313131
0100+  8F46             	db 49,49,49,49,49,49,49,49
0100+  8F46 3131313131313131
0101+  8F4E             	db 49,49,49,49,49,49,49,49
0101+  8F4E 3131313131313131
0102+  8F56             	db 49,49,49,49,49,49,49,49
0102+  8F56 3131313131313131
0103+  8F5E             	db 49,49,49,49,49,49,49,49
0103+  8F5E 3131313131313131
0104+  8F66             	db 49,49,49,49,49,49,49,49
0104+  8F66 3131313131313131
0105+  8F6E             	db 49,49,49,49,49,49,49,49
0105+  8F6E 3131313131313131
0106+  8F76             	db 49,49,49,49,49,49,49,49
0106+  8F76 3131313131313131
0107+  8F7E             	db 49,49,49,49,49,49,49,49
0107+  8F7E 3131313131313131
0108+  8F86             	db 49,49,49,49,49,49,49,49
0108+  8F86 3131313131313131
0109+  8F8E             	db 49,49,49,49,49,49,49,49
0109+  8F8E 3131313131313131
0110+  8F96             	db 49,49,49,49,49,49,49,49
0110+  8F96 3131313131313131
0111+  8F9E             	db 49,49,49,49,49,49,49,49
0111+  8F9E 3131313131313131
0112+  8FA6             	db 49,49,49,49,49,49,49,49
0112+  8FA6 3131313131313131
0113+  8FAE             	db 49,49,49,49,49,49,49,49
0113+  8FAE 3131313131313131
0114+  8FB6             	db 49,49,49,49,49,49,49,49
0114+  8FB6 3131313131313131
0115+  8FBE             	db 49,49,49,49,49,49,49,49
0115+  8FBE 3131313131313131
0116+  8FC6             	db 49,49,49,49,49,49,49,49
0116+  8FC6 3131313131313131
0117+  8FCE             	db 49,49,49,49,49,49,49,49
0117+  8FCE 3131313131313131
0118+  8FD6             	db 49,49,49,49,49,49,49,49
0118+  8FD6 3131313131313131
0119+  8FDE             	db 49,49,49,49,49,49,49,49
0119+  8FDE 3131313131313131
0120+  8FE6             	db 49,49,49,49,49,49,49,49
0120+  8FE6 3131313131313131
0121+  8FEE             	db 49,49,49,49,49,49,49,49
0121+  8FEE 3131313131313131
0122+  8FF6             	db 49,49,49,49,49,49,49,49
0122+  8FF6 3131313131313131
0123+  8FFE             	db 49,49,49,49,49,49,49,49
0123+  8FFE 3131313131313131
0124+  9006             	db 49,49,129,97,97,97,97,97
0124+  9006 3131816161616161
0125+  900E             	db 97,97,129,104,104,97,97,97
0125+  900E 6161816868616161
0126+  9016             	db 97,97,97,97,161,177,161,161
0126+  9016 61616161A1B1A1A1
0127+  901E             	db 161,161,161,161,161,161,161,161
0127+  901E A1A1A1A1A1A1A1A1
0128+  9026             	db 161,161,161,161,97,97,97,97
0128+  9026 A1A1A1A161616161
0129+  902E             	db 97,97,97,97,97,97,97,97
0129+  902E 6161616161616161
0130+  9036             	db 65,225,225,225,225,225,225,225
0130+  9036 41E1E1E1E1E1E1E1
0131+  903E             	db 65,225,225,225,225,225,225,225
0131+  903E 41E1E1E1E1E1E1E1
0132+  9046             	db 225,225,225,225,225,225,225,225
0132+  9046 E1E1E1E1E1E1E1E1
0133+  904E             	db 225,229,229,229,229,229,229,229
0133+  904E E1E5E5E5E5E5E5E5
0134+  9056             	db 17,225,225,78,225,225,78,225
0134+  9056 11E1E14EE1E14EE1
0135+  905E             	db 225,94,225,225,225,225,254,94
0135+  905E E15EE1E1E1E1FE5E
0136+  9066             	db 17,254,225,225,225,225,225,225
0136+  9066 11FEE1E1E1E1E1E1
0137+  906E             	db 225,225,65,225,225,225,225,225
0137+  906E E1E141E1E1E1E1E1
0138+  9076             	db 225,81,225,225,225,225,225,225
0138+  9076 E151E1E1E1E1E1E1
0139+  907E             	db 225,225,225,78,78,94,78,254
0139+  907E E1E1E14E4E5E4EFE
0140+  9086             	db 17,94,94,94,94,94,94,94
0140+  9086 115E5E5E5E5E5E5E
0141+  908E             	db 17,229,225,225,225,225,225,229
0141+  908E 11E5E1E1E1E1E1E5
0142+  9096             	db 17,225,225,225,225,94,225,225
0142+  9096 11E1E1E1E15EE1E1
0143+  909E             	db 225,78,94,94,225,225,94,94
0143+  909E E14E5E5EE1E15E5E
0144+  90A6             	db 97,97,97,97,97,97,97,97
0144+  90A6 6161616161616161
0145+  90AE             	db 97,97,97,97,97,97,97,97
0145+  90AE 6161616161616161
0146+  90B6             	db 97,239,225,78,225,225,225,239
0146+  90B6 61EFE14EE1E1E1EF
0147+  90BE             	db 225,225,225,225,225,225,225,225
0147+  90BE E1E1E1E1E1E1E1E1
0148+  90C6             	db 225,227,227,227,225,225,225,62
0148+  90C6 E1E3E3E3E1E1E13E
0149+  90CE             	db 97,163,174,174,174,163,174,49
0149+  90CE 61A3AEAEAEA3AE31
0150+  90D6             	db 97,161,161,106,161,161,161,161
0150+  90D6 61A1A16AA1A1A1A1
0151+  90DE             	db 161,206,225,206,225,225,206,225
0151+  90DE A1CEE1CEE1E1CEE1
0152+  90E6             	db 225,97,97,97,97,97,97,97
0152+  90E6 E161616161616161
0153+  90EE             	db 97,97,97,97,97,97,97,97
0153+  90EE 6161616161616161
0154+  90F6             	db 97,62,126,126,126,126,62,225
0154+  90F6 613E7E7E7E7E3EE1
0155+  90FE             	db 225,225,225,225,225,225,225,225
0155+  90FE E1E1E1E1E1E1E1E1
0156+  9106             	db 145,145,145,145,129,129,129,129
0156+  9106 9191919181818181
0157+  910E             	db 145,154,97,145,145,97,150,150
0157+  910E 919A619191619696
0158+  9116             	db 161,161,161,161,161,161,161,161
0158+  9116 A1A1A1A1A1A1A1A1
0159+  911E             	db 161,161,177,161,161,161,161,161
0159+  911E A1A1B1A1A1A1A1A1
0160+  9126             	db 97,97,97,97,97,97,97,97
0160+  9126 6161616161616161
0161+  912E             	db 97,97,97,97,97,97,97,97
0161+  912E 6161616161616161
0162+  9136             
0163+  9136             
0187   9136             	include "src/spriteset.asm"
0001+  9136             sprites_definition: 
0002+  9136             	db 1,3,7,3,6,7,3,1
0002+  9136 0103070306070301
0003+  913E             	db 1,3,2,2,3,1,1,1
0003+  913E 0103020203010101
0004+  9146             	db 240,240,224,224,208,240,176,224
0004+  9146 F0F0E0E0D0F0B0E0
0005+  914E             	db 224,240,208,208,240,224,32,176
0005+  914E E0F0D0D0F0E020B0
0006+  9156             ;Definition sprite 1, name: Sprite-3
0007+  9156             	db 1,1,1,1,3,3,1,0
0007+  9156 0101010103030100
0008+  915E             	db 0,1,1,1,1,0,0,0
0008+  915E 0001010101000000
0009+  9166             	db 240,240,240,240,104,248,232,240
0009+  9166 F0F0F0F068F8E8F0
0010+  916E             	db 240,248,168,208,248,240,160,112
0010+  916E F0F8A8D0F8F0A070
0011+  9176             ;Definition sprite 2, name: Sprite-0
0012+  9176             	db 15,15,7,7,11,15,13,7
0012+  9176 0F0F07070B0F0D07
0013+  917E             	db 7,15,11,11,15,7,4,13
0013+  917E 070F0B0B0F07040D
0014+  9186             	db 128,192,224,192,96,224,192,128
0014+  9186 80C0E0C060E0C080
0015+  918E             	db 128,192,64,64,192,128,128,128
0015+  918E 80C04040C0808080
0016+  9196             ;Definition sprite 3, name: Sprite-1
0017+  9196             	db 15,15,15,15,22,31,23,15
0017+  9196 0F0F0F0F161F170F
0018+  919E             	db 15,31,21,11,31,15,5,14
0018+  919E 0F1F150B1F0F050E
0019+  91A6             	db 128,128,128,128,192,192,128,0
0019+  91A6 80808080C0C08000
0020+  91AE             	db 0,128,128,128,128,0,0,0
0020+  91AE 0080808080000000
0021+  91B6             ;Definition sprite 4, name: Sprite-4
0022+  91B6             	db 7,7,7,7,15,15,7,3
0022+  91B6 070707070F0F0703
0023+  91BE             	db 7,15,11,9,15,7,2,6
0023+  91BE 070F0B090F070206
0024+  91C6             	db 192,192,192,192,224,224,192,128
0024+  91C6 C0C0C0C0E0E0C080
0025+  91CE             	db 192,224,160,32,224,224,64,96
0025+  91CE C0E0A020E0E04060
0026+  91D6             ;Definition sprite 5, name: Sprite-4
0027+  91D6             	db 3,7,7,7,15,15,7,3
0027+  91D6 030707070F0F0703
0028+  91DE             	db 7,15,13,9,15,7,2,2
0028+  91DE 070F0D090F070202
0029+  91E6             	db 128,192,192,192,224,224,192,128
0029+  91E6 80C0C0C0E0E0C080
0030+  91EE             	db 192,224,96,32,224,224,96,0
0030+  91EE C0E06020E0E06000
0031+  91F6             ;Definition sprite 6, name: Sprite-4
0032+  91F6             	db 7,7,7,7,13,15,6,3
0032+  91F6 070707070D0F0603
0033+  91FE             	db 7,15,11,13,7,3,2,6
0033+  91FE 070F0B0D07030206
0034+  9206             	db 192,192,192,192,96,224,192,128
0034+  9206 C0C0C0C060E0C080
0035+  920E             	db 192,224,160,96,192,192,64,96
0035+  920E C0E0A060C0C04060
0036+  9216             ;Definition sprite 7, name: Sprite-4
0037+  9216             	db 7,7,7,7,13,15,6,3
0037+  9216 070707070D0F0603
0038+  921E             	db 7,15,13,11,7,7,2,2
0038+  921E 070F0D0B07070202
0039+  9226             	db 192,192,192,192,96,224,192,128
0039+  9226 C0C0C0C060E0C080
0040+  922E             	db 192,224,96,160,192,192,96,0
0040+  922E C0E060A0C0C06000
0041+  9236             ;Definition sprite 8, name: Sprite-2
0042+  9236             	db 24,24,15,7,7,6,7,3
0042+  9236 18180F0707060703
0043+  923E             	db 1,1,2,2,3,3,1,1
0043+  923E 0101020203030101
0044+  9246             	db 0,0,192,192,224,160,224,96
0044+  9246 0000C0C0E0A0E060
0045+  924E             	db 192,224,160,160,224,224,192,64
0045+  924E C0E0A0A0E0E0C040
0046+  9256             ;Definition sprite 9, name: Sprite-2
0047+  9256             	db 0,24,31,3,3,3,3,1
0047+  9256 00181F0303030301
0048+  925E             	db 0,0,1,1,1,1,0,0
0048+  925E 0000010101010000
0049+  9266             	db 0,0,224,224,240,80,240,176
0049+  9266 0000E0E0F050F0B0
0050+  926E             	db 224,240,208,184,240,240,248,64
0050+  926E E0F0D0B8F0F0F840
0051+  9276             ;Definition sprite 10, name: Sprite-2
0052+  9276             	db 0,0,7,7,15,10,15,13
0052+  9276 000007070F0A0F0D
0053+  927E             	db 7,15,11,29,15,15,31,2
0053+  927E 070F0B1D0F0F1F02
0054+  9286             	db 0,24,248,192,192,192,192,128
0054+  9286 0018F8C0C0C0C080
0055+  928E             	db 0,0,128,128,128,128,0,0
0055+  928E 0000808080800000
0056+  9296             ;Definition sprite 11, name: Sprite-2
0057+  9296             	db 0,0,3,3,7,5,7,6
0057+  9296 0000030307050706
0058+  929E             	db 3,7,5,5,7,7,3,2
0058+  929E 0307050507070302
0059+  92A6             	db 24,24,240,224,224,96,224,192
0059+  92A6 1818F0E0E060E0C0
0060+  92AE             	db 128,128,64,64,192,192,128,128
0060+  92AE 80804040C0C08080
0061+  92B6             ;Definition sprite 12, name: Sprite-4
0062+  92B6             	db 0,7,7,7,7,7,7,1
0062+  92B6 0007070707070701
0063+  92BE             	db 7,14,14,15,15,7,2,3
0063+  92BE 070E0E0F0F070203
0064+  92C6             	db 0,224,240,240,176,224,224,128
0064+  92C6 00E0F0F0B0E0E080
0065+  92CE             	db 224,240,56,248,240,224,64,96
0065+  92CE E0F038F8F0E04060
0066+  92D6             ;Definition sprite 13, name: Sprite-4
0067+  92D6             	db 0,7,7,7,7,7,7,1
0067+  92D6 0007070707070701
0068+  92DE             	db 3,7,6,5,7,3,0,0
0068+  92DE 0307060507030000
0069+  92E6             	db 0,224,240,240,176,224,224,192
0069+  92E6 00E0F0F0B0E0E0C0
0070+  92EE             	db 240,120,252,252,248,240,160,144
0070+  92EE F078FCFCF8F0A090
0071+  92F6             ;Definition sprite 14, name: Sprite-4
0072+  92F6             	db 0,7,15,15,13,7,7,1
0072+  92F6 00070F0F0D070701
0073+  92FE             	db 7,15,28,31,15,7,2,6
0073+  92FE 070F1C1F0F070206
0074+  9306             	db 0,224,224,224,224,224,224,128
0074+  9306 00E0E0E0E0E0E080
0075+  930E             	db 224,112,112,240,240,224,64,192
0075+  930E E07070F0F0E040C0
0076+  9316             ;Definition sprite 15, name: Sprite-4
0077+  9316             	db 0,7,15,15,13,7,7,3
0077+  9316 00070F0F0D070703
0078+  931E             	db 15,30,63,63,31,15,5,9
0078+  931E 0F1E3F3F1F0F0509
0079+  9326             	db 0,224,224,224,224,224,224,128
0079+  9326 00E0E0E0E0E0E080
0080+  932E             	db 192,224,96,160,224,192,0,0
0080+  932E C0E060A0E0C00000
0081+  9336             ;Definition sprite 16, name: Sprite_name10
0082+  9336             	db 0,7,15,15,15,7,7,31
0082+  9336 00070F0F0F07071F
0083+  933E             	db 23,31,31,3,7,7,6,7
0083+  933E 171F1F0307070607
0084+  9346             	db 0,240,248,168,240,96,192,192
0084+  9346 00F0F8A8F060C0C0
0085+  934E             	db 224,176,192,224,224,96,112,56
0085+  934E E0B0C0E0E0607038
0086+  9356             ;Definition sprite 17, name: Sprite_name10
0087+  9356             	db 0,3,7,7,7,3,3,3
0087+  9356 0003070707030303
0088+  935E             	db 6,11,3,1,3,6,14,8
0088+  935E 060B030103060E08
0089+  9366             	db 0,248,252,212,248,176,224,224
0089+  9366 00F8FCD4F8B0E0E0
0090+  936E             	db 96,64,224,192,224,96,32,48
0090+  936E 6040E0C0E0602030
0091+  9376             ;Definition sprite 18, name: Sprite_name10
0092+  9376             	db 0,15,31,21,15,6,3,3
0092+  9376 000F1F150F060303
0093+  937E             	db 7,13,3,7,7,6,14,28
0093+  937E 070D030707060E1C
0094+  9386             	db 0,224,240,240,240,224,224,248
0094+  9386 00E0F0F0F0E0E0F8
0095+  938E             	db 232,248,248,192,224,224,96,224
0095+  938E E8F8F8C0E0E060E0
0096+  9396             ;Definition sprite 19, name: Sprite_name10
0097+  9396             	db 0,31,63,43,31,13,7,7
0097+  9396 001F3F2B1F0D0707
0098+  939E             	db 6,2,7,3,7,6,4,12
0098+  939E 060207030706040C
0099+  93A6             	db 0,192,224,224,224,192,192,192
0099+  93A6 00C0E0E0E0C0C0C0
0100+  93AE             	db 96,208,192,128,192,96,112,16
0100+  93AE 60D0C080C0607010
0101+  93B6             ;Definition sprite 20, name: Sprite-4
0102+  93B6             	db 31,31,31,31,31,31,3,15
0102+  93B6 1F1F1F1F1F1F030F
0103+  93BE             	db 23,39,23,15,7,3,3,3
0103+  93BE 1727170F07030303
0104+  93C6             	db 248,248,80,224,224,96,192,128
0104+  93C6 F8F850E0E060C080
0105+  93CE             	db 224,240,240,240,224,192,64,224
0105+  93CE E0F0F0F0E0C040E0
0106+  93D6             ;Definition sprite 21, name: Sprite-4
0107+  93D6             	db 15,15,15,15,15,15,7,1
0107+  93D6 0F0F0F0F0F0F0701
0108+  93DE             	db 3,3,3,3,3,1,7,4
0108+  93DE 0303030303010704
0109+  93E6             	db 240,248,80,240,240,176,224,192
0109+  93E6 F0F850F0F0B0E0C0
0110+  93EE             	db 224,96,184,160,224,224,192,192
0110+  93EE E060B8A0E0E0C0C0
0111+  93F6             ;Definition sprite 22, name: Sprite-4
0112+  93F6             	db 31,31,10,7,7,6,3,1
0112+  93F6 1F1F0A0707060301
0113+  93FE             	db 7,15,15,15,7,3,2,7
0113+  93FE 070F0F0F07030207
0114+  9406             	db 248,248,248,248,248,248,192,240
0114+  9406 F8F8F8F8F8F8C0F0
0115+  940E             	db 232,228,232,240,224,192,192,192
0115+  940E E8E4E8F0E0C0C0C0
0116+  9416             ;Definition sprite 23, name: Sprite-4
0117+  9416             	db 15,31,10,15,15,13,7,3
0117+  9416 0F1F0A0F0F0D0703
0118+  941E             	db 7,6,29,5,7,7,3,3
0118+  941E 07061D0507070303
0119+  9426             	db 240,240,240,240,240,240,224,128
0119+  9426 F0F0F0F0F0F0E080
0120+  942E             	db 192,192,192,192,192,128,224,32
0120+  942E C0C0C0C0C080E020
0121+  9436             ;Definition sprite 24, name: Sprite-34
0122+  9436             	db 0,3,7,7,7,7,3,1
0122+  9436 0003070707070301
0123+  943E             	db 3,5,5,6,3,1,3,3
0123+  943E 0305050603010303
0124+  9446             	db 0,192,224,240,160,192,192,128
0124+  9446 00C0E0F0A0C0C080
0125+  944E             	db 192,224,208,192,192,192,96,176
0125+  944E C0E0D0C0C0C060B0
0126+  9456             ;Definition sprite 25, name: Sprite-34
0127+  9456             	db 0,7,15,15,15,15,7,3
0127+  9456 00070F0F0F0F0703
0128+  945E             	db 7,28,15,15,7,15,26,19
0128+  945E 071C0F0F070F1A13
0129+  9466             	db 0,128,192,224,64,128,128,0
0129+  9466 0080C0E040808000
0130+  946E             	db 128,128,128,128,128,128,0,0
0130+  946E 8080808080800000
0131+  9476             ;Definition sprite 26, name: Sprite-34
0132+  9476             	db 0,3,7,15,5,3,3,1
0132+  9476 0003070F05030301
0133+  947E             	db 3,7,11,3,3,3,6,13
0133+  947E 03070B030303060D
0134+  9486             	db 0,192,224,224,224,224,192,128
0134+  9486 00C0E0E0E0E0C080
0135+  948E             	db 192,160,160,96,192,128,192,192
0135+  948E C0A0A060C080C0C0
0136+  9496             ;Definition sprite 27, name: Sprite-34
0137+  9496             	db 0,1,3,7,2,1,1,0
0137+  9496 0001030702010100
0138+  949E             	db 1,1,1,1,1,1,0,0
0138+  949E 0101010101010000
0139+  94A6             	db 0,224,240,240,240,240,224,192
0139+  94A6 00E0F0F0F0F0E0C0
0140+  94AE             	db 224,56,240,240,224,240,88,200
0140+  94AE E038F0F0E0F058C8
0141+  94B6             ;Definition sprite 28, name: Sprite-4
0142+  94B6             	db 0,0,0,3,3,7,7,6
0142+  94B6 0000000303070706
0143+  94BE             	db 7,7,3,7,7,3,2,3
0143+  94BE 0707030707030203
0144+  94C6             	db 0,0,0,192,192,224,224,160
0144+  94C6 000000C0C0E0E0A0
0145+  94CE             	db 224,96,192,224,224,192,64,96
0145+  94CE E060C0E0E0C04060
0146+  94D6             ;Definition sprite 29, name: Sprite-4
0147+  94D6             	db 0,0,0,0,0,7,7,7
0147+  94D6 0000000000070707
0148+  94DE             	db 7,7,3,7,11,3,2,3
0148+  94DE 070703070B030203
0149+  94E6             	db 0,0,0,0,96,224,224,96
0149+  94E6 0000000060E0E060
0150+  94EE             	db 224,128,192,240,192,192,96,0
0150+  94EE E080C0F0C0C06000
0151+  94F6             ;Definition sprite 30, name: Sprite-4
0152+  94F6             	db 0,0,0,3,3,7,7,5
0152+  94F6 0000000303070705
0153+  94FE             	db 7,6,3,7,7,3,2,6
0153+  94FE 0706030707030206
0154+  9506             	db 0,0,0,192,192,224,224,96
0154+  9506 000000C0C0E0E060
0155+  950E             	db 224,224,192,224,224,192,64,192
0155+  950E E0E0C0E0E0C040C0
0156+  9516             ;Definition sprite 31, name: Sprite-4
0157+  9516             	db 0,0,0,0,6,7,7,6
0157+  9516 0000000006070706
0158+  951E             	db 7,1,3,15,3,3,6,0
0158+  951E 0701030F03030600
0159+  9526             	db 0,0,0,0,0,224,224,224
0159+  9526 0000000000E0E0E0
0160+  952E             	db 224,224,192,224,208,192,64,192
0160+  952E E0E0C0E0D0C040C0
0161+  9536             ;Definition sprite 32, name: Sprite-22
0162+  9536             	db 1,3,3,7,7,7,7,7
0162+  9536 0103030707070707
0163+  953E             	db 39,23,15,7,15,23,7,6
0163+  953E 27170F070F170706
0164+  9546             	db 128,192,224,240,136,168,248,248
0164+  9546 80C0E0F088A8F8F8
0165+  954E             	db 248,168,0,80,248,248,108,36
0165+  954E F8A80050F8F86C24
0166+  9556             ;Definition sprite 33, name: Sprite-22
0167+  9556             	db 0,0,1,3,3,7,7,7
0167+  9556 0000010303070707
0168+  955E             	db 7,7,7,7,7,39,31,6
0168+  955E 0707070707271F06
0169+  9566             	db 0,0,128,192,224,240,248,136
0169+  9566 000080C0E0F0F888
0170+  956E             	db 168,248,248,248,0,122,252,216
0170+  956E A8F8F8F8007AFCD8
0171+  9576             ;Definition sprite 34, name: Sprite-22
0172+  9576             	db 1,3,7,15,17,21,31,31
0172+  9576 0103070F11151F1F
0173+  957E             	db 31,21,0,10,31,31,54,36
0173+  957E 1F15000A1F1F3624
0174+  9586             	db 128,192,192,224,224,224,224,224
0174+  9586 80C0C0E0E0E0E0E0
0175+  958E             	db 228,232,240,224,240,232,224,96
0175+  958E E4E8F0E0F0E8E060
0176+  9596             ;Definition sprite 35, name: Sprite-22
0177+  9596             	db 0,0,1,3,7,15,31,17
0177+  9596 00000103070F1F11
0178+  959E             	db 21,31,31,31,0,94,63,27
0178+  959E 151F1F1F005E3F1B
0179+  95A6             	db 0,0,128,192,192,224,224,224
0179+  95A6 000080C0C0E0E0E0
0180+  95AE             	db 224,224,224,224,224,228,248,96
0180+  95AE E0E0E0E0E0E4F860
0181+  95B6             ;Definition sprite 36, name: Sprite-20
0182+  95B6             	db 0,0,0,0,4,2,1,3
0182+  95B6 0000000004020103
0183+  95BE             	db 7,13,15,14,11,13,1,1
0183+  95BE 070D0F0E0B0D0101
0184+  95C6             	db 0,0,0,0,32,64,128,192
0184+  95C6 00000000204080C0
0185+  95CE             	db 224,176,240,176,208,152,64,160
0185+  95CE E0B0F0B0D09840A0
0186+  95D6             ;Definition sprite 37, name: Sprite-20
0187+  95D6             	db 0,0,0,0,0,0,28,3
0187+  95D6 0000000000001C03
0188+  95DE             	db 5,15,14,14,11,9,2,2
0188+  95DE 050F0E0E0B090202
0189+  95E6             	db 0,0,0,0,0,0,56,192
0189+  95E6 00000000000038C0
0190+  95EE             	db 160,240,240,48,208,144,128,192
0190+  95EE A0F0F030D09080C0
0191+  95F6             ;Definition sprite 38, name: Sprite-20
0192+  95F6             	db 0,0,0,0,4,2,1,3
0192+  95F6 0000000004020103
0193+  95FE             	db 7,13,15,13,11,25,2,5
0193+  95FE 070D0F0D0B190205
0194+  9606             	db 0,0,0,0,32,64,128,192
0194+  9606 00000000204080C0
0195+  960E             	db 224,176,240,112,208,176,128,128
0195+  960E E0B0F070D0B08080
0196+  9616             ;Definition sprite 39, name: Sprite-20
0197+  9616             	db 0,0,0,0,0,0,28,3
0197+  9616 0000000000001C03
0198+  961E             	db 5,15,15,12,11,9,1,3
0198+  961E 050F0F0C0B090103
0199+  9626             	db 0,0,0,0,0,0,56,192
0199+  9626 00000000000038C0
0200+  962E             	db 160,240,112,112,208,144,64,64
0200+  962E A0F07070D0904040
0201+  9636             ;Definition sprite 40, name: Sprite-21
0202+  9636             	db 0,3,7,15,14,30,28,28
0202+  9636 0003070F0E1E1C1C
0203+  963E             	db 30,15,15,31,18,18,18,27
0203+  963E 1E0F0F1F1212121B
0204+  9646             	db 0,128,192,192,0,0,0,0
0204+  9646 0080C0C000000000
0205+  964E             	db 0,12,208,224,240,40,64,0
0205+  964E 000CD0E0F0284000
0206+  9656             ;Definition sprite 41, name: Sprite-21
0207+  9656             	db 0,0,30,31,7,3,7,7
0207+  9656 00001E1F07030707
0208+  965E             	db 7,7,3,3,7,4,13,17
0208+  965E 0707030307040D11
0209+  9666             	db 0,0,0,128,128,128,128,0
0209+  9666 0000008080808000
0210+  966E             	db 0,144,200,244,216,160,56,0
0210+  966E 0090C8F4D8A03800
0211+  9676             ;Definition sprite 42, name: Sprite-21
0212+  9676             	db 0,1,3,3,0,0,0,0
0212+  9676 0001030300000000
0213+  967E             	db 0,48,11,7,15,20,2,0
0213+  967E 00300B070F140200
0214+  9686             	db 0,192,224,240,112,120,56,56
0214+  9686 00C0E0F070783838
0215+  968E             	db 120,240,240,248,72,72,72,216
0215+  968E 78F0F0F8484848D8
0216+  9696             ;Definition sprite 43, name: Sprite-21
0217+  9696             	db 0,0,0,1,1,1,1,0
0217+  9696 0000000101010100
0218+  969E             	db 0,9,19,47,27,5,28,0
0218+  969E 0009132F1B051C00
0219+  96A6             	db 0,0,120,248,224,192,224,224
0219+  96A6 000078F8E0C0E0E0
0220+  96AE             	db 224,224,192,192,224,32,176,136
0220+  96AE E0E0C0C0E020B088
0221+  96B6             ;Definition sprite 44, name: Sprite-22
0222+  96B6             	db 0,3,15,29,31,31,15,15
0222+  96B6 00030F1D1F1F0F0F
0223+  96BE             	db 15,19,35,7,7,14,14,15
0223+  96BE 0F132307070E0E0F
0224+  96C6             	db 0,224,224,160,240,152,104,240
0224+  96C6 00E0E0A0F09868F0
0225+  96CE             	db 224,144,136,192,224,96,96,112
0225+  96CE E09088C0E0606070
0226+  96D6             ;Definition sprite 45, name: Sprite-22
0227+  96D6             	db 0,7,31,59,63,63,30,31
0227+  96D6 00071F3B3F3F1E1F
0228+  96DE             	db 31,39,71,15,30,18,34,51
0228+  96DE 1F27470F1E122233
0229+  96E6             	db 0,224,192,64,224,240,16,224
0229+  96E6 00E0C040E0F010E0
0230+  96EE             	db 192,128,0,0,0,0,0,128
0230+  96EE C080000000000080
0231+  96F6             ;Definition sprite 46, name: Sprite-22
0232+  96F6             	db 0,7,7,5,15,25,22,15
0232+  96F6 000707050F19160F
0233+  96FE             	db 7,9,17,3,7,6,6,14
0233+  96FE 070911030706060E
0234+  9706             	db 0,192,240,184,248,248,240,240
0234+  9706 00C0F0B8F8F8F0F0
0235+  970E             	db 240,200,196,224,224,112,112,240
0235+  970E F0C8C4E0E07070F0
0236+  9716             ;Definition sprite 47, name: Sprite-22
0237+  9716             	db 0,7,3,2,7,15,8,7
0237+  9716 00070302070F0807
0238+  971E             	db 3,1,0,0,0,0,0,1
0238+  971E 0301000000000001
0239+  9726             	db 0,224,248,220,252,252,120,248
0239+  9726 00E0F8DCFCFC78F8
0240+  972E             	db 248,228,226,240,120,72,68,204
0240+  972E F8E4E2F0784844CC
0241+  9736             
0242+  9736             
0188   9736                 include "./src/musicint.asm"
0001+  9736             
0002+  9736             HKEYI equ #FD9A
0003+  9736             HTIMI equ #FD9F ;Vblank
0004+  9736             MAX_CONTADOR equ 50
0005+  9736             rutina_previa equ #f202      
0006+  9736             ;rutina_previa: ds 5      
0007+  9736             musica_activa:  equ #8504
0008+  9736             efecto_activo:  equ #8505
0009+  9736             inicilizar_tracker: 
0010+  9736 DD E5           push ix
0011+  9738                 ;Deactivamos las interrupciones
0012+  9738 F3              di	
0013+  9739                 ; hemos puesto a mano a 1 para que siempre se repita la canción en la variable PT3_SETUP
0014+  9739                 ;LD		 A, (PT3_SETUP)
0015+  9739                 ;AND		11111110b
0016+  9739                 ;LD		(PT3_SETUP), A
0017+  9739             
0018+  9739 3A 04 85        ld a,(musica_activa)
0019+  973C FE 01           cp 1;Si es 1 es la música del menu
0020+  973E 28 0A           jr z,.musica_menu
0021+  9740 FE 02           cp 2
0022+  9742 28 10           jr z,.musica_ingame
0023+  9744 FE 03           cp 3
0024+  9746 28 07           jr z,.musica_final
0025+  9748 18 0D           jr .inicializa_cancion
0026+  974A             .musica_menu: ;https://zxart.ee/spa/autores/c/cj-echo/wild-quaker3/
0027+  974A 21 B1 9F        ld hl, menu-99
0028+  974D 18 08           jr .inicializa_cancion
0029+  974F             .musica_final: 
0030+  974F 21 7A A2    	ld hl, final-99	
0031+  9752 18 03           jr .inicializa_cancion
0032+  9754             .musica_ingame: 
0033+  9754 21 7A 9D    	ld hl, ingame-99		; hl vale la direccion donde se encuentra la cancion - 99
0034+  9757             
0035+  9757             
0036+  9757             .inicializa_cancion: 
0037+  9757 CD EE 97    	call PT3_INIT			; Inicia el reproductor de PT3
0038+  975A                 
0039+  975A                 ;Salvamos la rutina ISR(Interrupt service routine) si hubiese alguna.Son 5 bytes
0040+  975A 21 9F FD        ld hl,HTIMI
0041+  975D 11 02 F2        ld de,rutina_previa
0042+  9760 01 05 00        ld bc,5
0043+  9763 ED B0           ldir
0044+  9765             
0045+  9765                 ;instalamos nuestra rutina
0046+  9765 3E C3           ld a,#c3
0047+  9767 32 9F FD        ld (HTIMI),a
0048+  976A 21 7A 97        ld hl, reproducir_bloque_musica
0049+  976D 22 A0 FD        ld (HTIMI+1), hl
0050+  9770                 ;Activamos las interrupciones
0051+  9770 FB          	ei 
0052+  9771                 
0053+  9771                 ;inicializacion del reproductor de efectos sonoros
0054+  9771                 ;ld a,(efecto_activo)
0055+  9771                 ;or a ; si el efecto está activo nos activará el flag z
0056+  9771                 ;jp z, reproducir_bloque_musica
0057+  9771 21 42 AA        LD		HL, sfx_bank
0058+  9774 CD 65 A9        CALL	ayFX_SETUP
0059+  9777                 ;Volvemos al basic
0060+  9777 DD E1           pop ix
0061+  9779 C9              ret
0062+  977A             
0063+  977A             reproducir_bloque_musica: 
0064+  977A                 ;------------------Reproducir Bloque de múscia--------
0065+  977A                 ;halt						;sincronizacion
0066+  977A             	;di
0067+  977A             
0068+  977A 3A 04 85        ld a,(musica_activa)
0069+  977D B7              or a
0070+  977E CA 92 97        jp z,.end_reproducir_bloque_musica
0071+  9781 CD 33 9D    	call	PT3_ROUT			;Borrar el valor anterior
0072+  9784 CD 3B 9C    	call	PT3_PLAY			;Reproduce el siguiente trozo de canción
0073+  9787             
0074+  9787 3A 05 85        ld a,(efecto_activo)
0075+  978A B7              or a  ; si el efecto está activo nos activará el flag z
0076+  978B CA 92 97        jp z,.end_reproducir_bloque_musica
0077+  978E C3 AD A9        JP		ayFX_PLAY	
0078+  9791                 ;ei
0079+  9791                 ;--------------Fin de reproducir bloque de música-----
0080+  9791                 ;lanzamos la rutina que había
0081+  9791                 ;jp rutina_previa
0082+  9791                 ;Volvemos al basic
0083+  9791 C9              ret
0084+  9792             .end_reproducir_bloque_musica: 
0085+  9792                 ;call PT3_MUTE
0086+  9792 3E 01           ld a ,1
0087+  9794 32 05 85        ld (efecto_activo),a
0088+  9797 C9              ret
0089+  9798             para_cancion: 
0090+  9798                 ;volvemos a poner los 5 bytes que tenía
0091+  9798 F3              di
0092+  9799                 ;ld hl,rutina_previa
0093+  9799                 ;ld de,HTIMI
0094+  9799                 ;ld bc,5
0095+  9799                 ;ldir
0096+  9799 CD E2 97        call PT3_MUTE
0097+  979C                 ;xor a
0098+  979C                 ;ld (musica_activa),a
0099+  979C FB              ei
0100+  979D C9              ret
0101+  979E             
0102+  979E             sigue_musica: 
0103+  979E 3E 01           ld a,1
0104+  97A0 32 04 85        ld (musica_activa),a
0105+  97A3 C9              ret
0106+  97A4             efecto_toque: 
0107+  97A4 3E 00           LD			A, 0; 
0108+  97A6 0E 01           LD			C, 1
0109+  97A8 CD 77 A9        CALL		ayFX_INIT
0110+  97AB C9              ret
0111+  97AC             efecto_golpe: 
0112+  97AC 3E 00           ld a,0
0113+  97AE 32 05 85        ld (efecto_activo),a
0114+  97B1 3E 01           LD			A, 1; 
0115+  97B3 0E 01           LD			C, 1
0116+  97B5 CD 77 A9        CALL		ayFX_INIT
0117+  97B8 C9              ret
0118+  97B9             efecto_romper: 
0119+  97B9 3E 06           LD			A, 6; 
0120+  97BB 0E 01           LD			C, 1
0121+  97BD CD 77 A9        CALL		ayFX_INIT
0122+  97C0 C9              ret
0123+  97C1             
0124+  97C1             efecto_coge_botella: 
0125+  97C1 3E 0A           LD			A, 10; 
0126+  97C3 0E 01           LD			C, 1
0127+  97C5 CD 77 A9        CALL		ayFX_INIT
0128+  97C8 C9              ret
0129+  97C9             efecto_mata_player: 
0130+  97C9 3E 0D           LD			A, 13; 
0131+  97CB 0E 01           LD			C, 1
0132+  97CD CD 77 A9        CALL		ayFX_INIT
0133+  97D0 C9              ret
0134+  97D1             
0135+  97D1             ;includes para sjasmplus
0136+  97D1             ;tracker:
0137+  97D1             ;	include	"./src/PT3_player.asm"					
0138+  97D1             ;ingame:
0139+  97D1             ;	incbin "./src/dd.pt3"	
0140+  97D1             ;menu:
0141+  97D1             ;    incbin "./src/musicdisc.pt3"		
0142+  97D1             ;fx_player:
0143+  97D1             ;    include	"./src/ayFX_player.asm"	
0144+  97D1             ;sfx_bank:
0145+  97D1             ;	incbin "./src/sfx.afb"
0146+  97D1             
0147+  97D1             tracker: 
0148+  97D1             	include	"PT3_player.asm"			
0001++ 97D1             		; --- PT3 REPLAYER WORKING ON ROM ---
0002++ 97D1             		; --- Can be assembled with asMSX ---
0003++ 97D1             		; --- ROM version: MSX-KUN        ---
0004++ 97D1             		; --- asMSX version 2: SapphiRe   ---
0005++ 97D1             
0006++ 97D1             ; Based on MSX full version of PT3 by Dioniso
0007++ 97D1             ;
0008++ 97D1             ; This version of the replayer can be used with any note table
0009++ 97D1             ; This version also allows the use of PT3 commands
0010++ 97D1             ; First 99 bytes of each PT3 module should be stripped off
0011++ 97D1             ;
0012++ 97D1             ; PLAY and PSG WRITE routines seperated to allow independent calls
0013++ 97D1             ;
0014++ 97D1             ; ROM LENGTH: 1549 bytes
0015++ 97D1             ; RAM LENGTH:  576 bytes
0016++ 97D1             
0017++ 97D1             
0018++ 97D1             
0019++ 97D1             ;SJASM version by BTV 2016
0020++ 97D1             
0021++ 97D1             
0022++ 97D1             		; --- CONSTANT VALUES DEFINITION ---
0023++ 97D1             
0024++ 97D1             ;ChannelsVars
0025++ 97D1             ;struc	CHNPRM
0026++ 97D1             ;reset group
0027++ 97D1             CHNPRM_PsInOr	equ 0	;RESB 1
0028++ 97D1             CHNPRM_PsInSm	equ 1	;RESB 1
0029++ 97D1             CHNPRM_CrAmSl	equ 2	;RESB 1
0030++ 97D1             CHNPRM_CrNsSl	equ 3	;RESB 1
0031++ 97D1             CHNPRM_CrEnSl	equ 4	;RESB 1
0032++ 97D1             CHNPRM_TSlCnt	equ 5	;RESB 1
0033++ 97D1             CHNPRM_CrTnSl	equ 6	;RESW 1
0034++ 97D1             CHNPRM_TnAcc	equ 8	;RESW 1
0035++ 97D1             CHNPRM_COnOff	equ 10	;RESB 1
0036++ 97D1             ;reset group
0037++ 97D1             
0038++ 97D1             CHNPRM_OnOffD	equ 11	;RESB 1
0039++ 97D1             
0040++ 97D1             ;IX for PTDECOD here [+12]
0041++ 97D1             CHNPRM_OffOnD	equ 12	;RESB 1
0042++ 97D1             CHNPRM_OrnPtr	equ 13	;RESW 1
0043++ 97D1             CHNPRM_SamPtr	equ 15	;RESW 1
0044++ 97D1             CHNPRM_NNtSkp	equ 17	;RESB 1
0045++ 97D1             CHNPRM_Note	equ 18	;RESB 1
0046++ 97D1             CHNPRM_SlToNt	equ 19	;RESB 1
0047++ 97D1             CHNPRM_Env_En	equ 20	;RESB 1
0048++ 97D1             CHNPRM_Flags	equ 21	;RESB 1
0049++ 97D1              ;Enabled - 0,SimpleGliss - 2
0050++ 97D1             CHNPRM_TnSlDl	equ 22	;RESB 1
0051++ 97D1             CHNPRM_TSlStp	equ 23	;RESW 1
0052++ 97D1             CHNPRM_TnDelt	equ 25	;RESW 1
0053++ 97D1             CHNPRM_NtSkCn	equ 27	;RESB 1
0054++ 97D1             CHNPRM_Volume	equ 28	;RESB 1
0055++ 97D1             CHNPRM_Size	equ 29	;RESB 1
0056++ 97D1             ;endstruc
0057++ 97D1             
0058++ 97D1             ;struc	AR
0059++ 97D1             AR_TonA		equ 0	;RESW 1
0060++ 97D1             AR_TonB		equ 2	;RESW 1
0061++ 97D1             AR_TonC		equ 4	;RESW 1
0062++ 97D1             AR_Noise	equ 6	;RESB 1
0063++ 97D1             AR_Mixer	equ 7	;RESB 1
0064++ 97D1             AR_AmplA	equ 8	;RESB 1
0065++ 97D1             AR_AmplB	equ 9	;RESB 1
0066++ 97D1             AR_AmplC	equ 10	;RESB 1
0067++ 97D1             AR_Env		equ 11	;RESW 1
0068++ 97D1             AR_EnvTp	equ 13	;RESB 1
0069++ 97D1             ;endstruc
0070++ 97D1              
0071++ 97D1             		; --- CODE STARTS HERE ---
0072++ 97D1             
0073++ 97D1 21 00 F0    CHECKLP: 	LD	HL,PT3_SETUP
0074++ 97D4 CB FE       		SET	7,[HL]
0075++ 97D6 CB 46       		BIT	0,[HL]
0076++ 97D8 C8          		RET	Z
0077++ 97D9 E1          		POP	HL
0078++ 97DA 21 7A F0    		LD	HL,DelyCnt
0079++ 97DD 34          		INC	[HL]
0080++ 97DE 21 3E F0    		LD	HL,ChanA+CHNPRM_NtSkCn
0081++ 97E1 34          		INC	[HL]
0082++ 97E2 AF          PT3_MUTE: 	XOR	A
0083++ 97E3 67          		LD	H,A
0084++ 97E4 6F          		LD	L,A
0085++ 97E5 32 48 F1    		LD	[AYREGS+AR_AmplA],A
0086++ 97E8 22 49 F1    		LD	[AYREGS+AR_AmplB],HL
0087++ 97EB C3 34 9D    		JP	ROUT_A0
0088++ 97EE             
0089++ 97EE             PT3_INIT: 	;HL - AddressOfModule - 100
0090++ 97EE 22 01 F0    		LD [PT3_MODADDR],HL
0091++ 97F1 E5          		PUSH HL
0092++ 97F2 11 64 00    		LD DE,100
0093++ 97F5 19          		ADD HL,DE
0094++ 97F6 7E          		LD A,[HL]
0095++ 97F7 32 1C F0    		LD [PT3_Delay],A
0096++ 97FA E5          		PUSH HL
0097++ 97FB DD E1       		POP IX
0098++ 97FD 19          		ADD HL,DE
0099++ 97FE 22 03 F0    		LD [PT3_CrPsPtr],HL
0100++ 9801 DD 5E 02    		LD E,[IX+102-100]
0101++ 9804 19          		ADD HL,DE
0102++ 9805 23          		INC HL
0103++ 9806 22 18 F0    		LD [PT3_LPosPtr],HL
0104++ 9809 D1          		POP DE
0105++ 980A DD 6E 03    		LD L,[IX+103-100]
0106++ 980D DD 66 04    		LD H,[IX+104-100]
0107++ 9810 19          		ADD HL,DE
0108++ 9811 22 1A F0    		LD [PT3_PatsPtr],HL
0109++ 9814 21 A9 00    		LD HL,169
0110++ 9817 19          		ADD HL,DE
0111++ 9818 22 07 F0    		LD [PT3_OrnPtrs],HL
0112++ 981B 21 69 00    		LD HL,105
0113++ 981E 19          		ADD HL,DE
0114++ 981F 22 05 F0    		LD [PT3_SAMPTRS],HL
0115++ 9822 21 00 F0    		LD HL,PT3_SETUP
0116++ 9825 CB BE       		RES 7,[HL]
0117++ 9827             
0118++ 9827             		; --- note table data depacker ---
0119++ 9827             		; Depacks first 12 tones of each tone table
0120++ 9827             
0121++ 9827 11 A8 9D    		LD DE,T_PACK
0122++ 982A 01 B1 F1    		LD BC,T1_+(2*49)-1
0123++ 982D 1A          .TP_0: 		LD A,[DE]
0124++ 982E 13          		INC DE
0125++ 982F FE 1E       		CP 15*2
0126++ 9831 30 06       		JR NC,.TP_1
0127++ 9833 67          		LD H,A
0128++ 9834 1A          		LD A,[DE]
0129++ 9835 6F          		LD L,A
0130++ 9836 13          		INC DE
0131++ 9837 18 07       		JR .TP_2
0132++ 9839 D5          .TP_1: 		PUSH DE
0133++ 983A 16 00       		LD D,0
0134++ 983C 5F          		LD E,A
0135++ 983D 19          		ADD HL,DE
0136++ 983E 19          		ADD HL,DE
0137++ 983F D1          		POP DE
0138++ 9840 7C          .TP_2: 		LD A,H
0139++ 9841 02          		LD [BC],A
0140++ 9842 0B          		DEC BC
0141++ 9843 7D          		LD A,L
0142++ 9844 02          		LD [BC],A
0143++ 9845 0B          		DEC BC
0144++ 9846 D6 F0       		SUB $F0
0145++ 9848 20 E3       		JR NZ,.TP_0
0146++ 984A             
0147++ 984A             		; --- INITIALIZE PT3 VARIABLES ---
0148++ 984A 21 23 F0    		LD HL,VARS
0149++ 984D 77          		LD [HL],A
0150++ 984E 11 24 F0    		LD DE,VARS+1
0151++ 9851 01 2C 01    		LD BC,VAR0END-VARS-1
0152++ 9854 ED B0       		LDIR
0153++ 9856             
0154++ 9856 3C          		INC A
0155++ 9857 32 7A F0    		LD [DelyCnt],A
0156++ 985A 21 01 F0    		LD HL,$F001 ;H - CHNPRM_Volume, L - CHNPRM_NtSkCn
0157++ 985D 22 3E F0    		LD [ChanA+CHNPRM_NtSkCn],HL
0158++ 9860 22 5B F0    		LD [ChanB+CHNPRM_NtSkCn],HL
0159++ 9863 22 78 F0    		LD [ChanC+CHNPRM_NtSkCn],HL
0160++ 9866             
0161++ 9866 21 A4 9D    		LD HL,EMPTYSAMORN
0162++ 9869 22 12 F0    		LD [PT3_AdInPtA],HL ;ptr to zero
0163++ 986C 22 30 F0    		LD [ChanA+CHNPRM_OrnPtr],HL ;ornament 0 is "0,1,0"
0164++ 986F 22 4D F0    		LD [ChanB+CHNPRM_OrnPtr],HL ;in all versions from
0165++ 9872 22 6A F0    		LD [ChanC+CHNPRM_OrnPtr],HL ;3.xx to 3.6x and VTII
0166++ 9875             
0167++ 9875 22 32 F0    		LD [ChanA+CHNPRM_SamPtr],HL ;S1 There is no default
0168++ 9878 22 4F F0    		LD [ChanB+CHNPRM_SamPtr],HL ;S2 sample in PT3, so, you
0169++ 987B 22 6C F0    		LD [ChanC+CHNPRM_SamPtr],HL ;S3 can comment S1,2,3; see
0170++ 987E             					    ;also EMPTYSAMORN comment
0171++ 987E             
0172++ 987E             		; --- NOTE TABLE CREATOR (c) Ivan Roshin, adapted by SapphiRe ---
0173++ 987E DD 7E FF    		LD A,[IX+99-100] ;TONE TABLE NUMBER
0174++ 9881 17          		RLA
0175++ 9882 E6 07       		AND 7
0176++ 9884 21 54 9D    		LD HL,NT_DATA
0177++ 9887 D5          		PUSH DE
0178++ 9888 50          		LD D,B		; ld d,0 (bc is 0000 after LDIR)
0179++ 9889 87          		ADD A,A
0180++ 988A 5F          		LD E,A
0181++ 988B 19          		ADD HL,DE	; hl -> init of correct note table data
0182++ 988C 5E          		LD E,[HL]
0183++ 988D 23          		INC HL
0184++ 988E CB 3B       		SRL E
0185++ 9890 9F          		SBC A,A
0186++ 9891 E6 A7       		AND $A7			;$00 (NOP) or $A7 (AND A)
0187++ 9893 32 21 F0    		LD [PT3_NTL3],A		; CORRECT INSTRUCTION, DEPENDS OF SELECTED TABLE
0188++ 9896 3E C9       		LD A,$C9		; RET CODE
0189++ 9898 32 22 F0    		LD [PT3_NTL3+1],A	; RET PLACED
0190++ 989B EB          		EX DE,HL
0191++ 989C C1          		POP BC ;BC=T1_
0192++ 989D 09          		ADD HL,BC
0193++ 989E             
0194++ 989E 1A          		LD A,[DE]                           
0195++ 989F             
0196++ 989F 01 64 9D    		LD BC,T_
0197++ 98A2 81          		ADD A,C
0198++ 98A3 4F          		LD C,A
0199++ 98A4 88          		ADC A,B
0200++ 98A5             
0201++ 98A5 91          		SUB C
0202++ 98A6 47          		LD B,A
0203++ 98A7 C5          		PUSH BC
0204++ 98A8 11 80 F0    		LD DE,NT_
0205++ 98AB D5          		PUSH DE
0206++ 98AC             
0207++ 98AC 06 0C       		LD B,12
0208++ 98AE C5          .L1: 		PUSH BC
0209++ 98AF 4E          		LD C,[HL]
0210++ 98B0 23          		INC HL
0211++ 98B1 E5          		PUSH HL
0212++ 98B2 46          		LD B,[HL]
0213++ 98B3             
0214++ 98B3 D5          		PUSH DE
0215++ 98B4 EB          		EX DE,HL
0216++ 98B5 11 17 00    		LD DE,23
0217++ 98B8 DD 26 08    		db $DD,$26,$08	;LD XH,8
0218++ 98BB             
0219++ 98BB CB 38       .L2: 		SRL B
0220++ 98BD CB 19       		RR C
0221++ 98BF CD 21 F0    .L3: 		CALL PT3_NTL3	;AND A or NOP
0222++ 98C2 79          		LD A,C
0223++ 98C3 8A          		ADC A,D	;=ADC 0
0224++ 98C4 77          		LD [HL],A
0225++ 98C5 23          		INC HL
0226++ 98C6 78          		LD A,B
0227++ 98C7 8A          		ADC A,D
0228++ 98C8 77          		LD [HL],A
0229++ 98C9 19          		ADD HL,DE
0230++ 98CA DD 25       		db $DD,$25	;DEC XH
0231++ 98CC 20 ED       		JR NZ,.L2
0232++ 98CE             
0233++ 98CE D1          		POP DE
0234++ 98CF 13          		INC DE
0235++ 98D0 13          		INC DE
0236++ 98D1 E1          		POP HL
0237++ 98D2 23          		INC HL
0238++ 98D3 C1          		POP BC
0239++ 98D4 10 D8       		DJNZ .L1
0240++ 98D6             
0241++ 98D6 E1          		POP HL
0242++ 98D7 D1          		POP DE
0243++ 98D8             
0244++ 98D8 7B          		LD A,E
0245++ 98D9 D5          		PUSH DE
0246++ 98DA 11 70 9D    		LD DE,TCOLD_1
0247++ 98DD BB          		CP E
0248++ 98DE D1          		POP DE
0249++ 98DF 20 05       		JR NZ,.CORR_1
0250++ 98E1 3E FD       		LD A,$FD
0251++ 98E3 32 AE F0    		LD [NT_+$2E],A
0252++ 98E6             
0253++ 98E6 1A          .CORR_1: 	LD A,[DE]
0254++ 98E7 A7          		AND A
0255++ 98E8 28 11       		JR Z,.TC_EXIT
0256++ 98EA 1F          		RRA
0257++ 98EB F5          		PUSH AF
0258++ 98EC 87          		ADD A,A
0259++ 98ED 4F          		LD C,A
0260++ 98EE 09          		ADD HL,BC
0261++ 98EF F1          		POP AF
0262++ 98F0 30 02       		JR NC,.CORR_2
0263++ 98F2 35          		DEC [HL]
0264++ 98F3 35          		DEC [HL]
0265++ 98F4 34          .CORR_2: 	INC [HL]
0266++ 98F5 A7          		AND A
0267++ 98F6 ED 42       		SBC HL,BC
0268++ 98F8 13          		INC DE
0269++ 98F9 18 EB       		JR .CORR_1
0270++ 98FB             
0271++ 98FB             .TC_EXIT: 	;POP AF
0272++ 98FB             
0273++ 98FB             		; --- CREATE PT3 VOLUME TABLE (c) Ivan Roshin, adapted by SapphiRe ---
0274++ 98FB 21 11 00    		ld	hl,$11
0275++ 98FE 54          		ld	d,h
0276++ 98FF 5C          		ld	e,h
0277++ 9900 DD 21 50 F1 		ld	IX,VT_+16
0278++ 9904 06 0F       		ld	b,15
0279++ 9906 E5          .INITV1: 	push	hl
0280++ 9907 19          		add	hl,de
0281++ 9908 EB          		ex	de,hl
0282++ 9909 ED 62       		sbc	hl,hl
0283++ 990B 48          		ld	c,b
0284++ 990C 06 10       		ld	b,16
0285++ 990E 7D          .INITV2: 	ld	a,l
0286++ 990F 17          		rla
0287++ 9910 7C          		ld	a,h
0288++ 9911 CE 00       		adc	a,0
0289++ 9913 DD 77 00    		ld	[ix],a
0290++ 9916 DD 23       		inc	ix
0291++ 9918 19          		add	hl,de
0292++ 9919 10 F3       		djnz	.INITV2
0293++ 991B E1          		pop	hl
0294++ 991C 7B          		ld	a,e
0295++ 991D FE 77       		cp	$77
0296++ 991F 20 01       		jr	nz,.INITV3
0297++ 9921 1C          		inc	e
0298++ 9922 41          .INITV3: 	ld	b,c
0299++ 9923 10 E1       		djnz	.INITV1
0300++ 9925             
0301++ 9925 C9          		RET
0302++ 9926             
0303++ 9926             		;pattern decoder
0304++ 9926 DD 36 08 00 PD_OrSm: 	LD [IX+(CHNPRM_Env_En-12)],0
0305++ 992A CD B0 9A    		CALL SETORN
0306++ 992D 0A          		LD A,[BC]
0307++ 992E 03          		INC BC
0308++ 992F 0F          		RRCA
0309++ 9930             
0310++ 9930 87          PD_SAM: 		ADD A,A
0311++ 9931 5F          PD_SAM_: 	LD E,A
0312++ 9932 16 00       		LD D,0
0313++ 9934 2A 05 F0    		LD HL,[PT3_SAMPTRS]
0314++ 9937 19          		ADD HL,DE
0315++ 9938 5E          		LD E,[HL]
0316++ 9939 23          		INC HL
0317++ 993A 56          		LD D,[HL]
0318++ 993B 2A 01 F0    		LD HL,[PT3_MODADDR]
0319++ 993E 19          		ADD HL,DE
0320++ 993F DD 75 03    		LD [IX+(CHNPRM_SamPtr-12)],L
0321++ 9942 DD 74 04    		LD [IX+(CHNPRM_SamPtr+1-12)],H
0322++ 9945 18 41       		JR PD_LOOP
0323++ 9947             
0324++ 9947 07          PD_VOL: 		RLCA
0325++ 9948 07          		RLCA
0326++ 9949 07          		RLCA
0327++ 994A 07          		RLCA
0328++ 994B DD 77 10    		LD [IX+(CHNPRM_Volume-12)],A
0329++ 994E 18 3B       		JR PD_LP2
0330++ 9950             	
0331++ 9950 DD 77 08    PD_EOff: 	LD [IX+(CHNPRM_Env_En-12)],A
0332++ 9953 DD 77 F4    		LD [IX+(CHNPRM_PsInOr-12)],A
0333++ 9956 18 33       		JR PD_LP2
0334++ 9958             
0335++ 9958 3D          PD_SorE: 	DEC A
0336++ 9959 20 07       		JR NZ,PD_ENV
0337++ 995B 0A          		LD A,[BC]
0338++ 995C 03          		INC BC
0339++ 995D DD 77 05    		LD [IX+(CHNPRM_NNtSkp-12)],A
0340++ 9960 18 29       		JR PD_LP2
0341++ 9962             
0342++ 9962 CD 94 9A    PD_ENV: 		CALL SETENV
0343++ 9965 18 24       		JR PD_LP2
0344++ 9967             
0345++ 9967 CD B0 9A    PD_ORN: 		CALL SETORN
0346++ 996A 18 1C       		JR PD_LOOP
0347++ 996C                    
0348++ 996C DD 77 08    PD_ESAM: 	LD [IX+(CHNPRM_Env_En-12)],A
0349++ 996F DD 77 F4    		LD [IX+(CHNPRM_PsInOr-12)],A
0350++ 9972 C4 94 9A    		CALL NZ,SETENV
0351++ 9975 0A          		LD A,[BC]
0352++ 9976 03          		INC BC
0353++ 9977 18 B8       		JR PD_SAM_
0354++ 9979             
0355++ 9979 DD 7E 06    PTDECOD: 	LD A,[IX+(CHNPRM_Note-12)]
0356++ 997C 32 0F F0    		LD [PT3_PrNote],A
0357++ 997F DD 6E FA    		LD L,[IX+(CHNPRM_CrTnSl-12)]
0358++ 9982 DD 66 FB    		LD H,[IX+(CHNPRM_CrTnSl+1-12)]
0359++ 9985 22 10 F0    		LD [PT3_PrSlide],HL
0360++ 9988             
0361++ 9988 11 10 20    PD_LOOP: 	LD DE,$2010
0362++ 998B 0A          PD_LP2: 		LD A,[BC]
0363++ 998C 03          		INC BC
0364++ 998D 83          		ADD A,E
0365++ 998E 38 96       		JR C,PD_OrSm
0366++ 9990 82          		ADD A,D
0367++ 9991 28 4A       		JR Z,PD_FIN
0368++ 9993 38 9B       		JR C,PD_SAM
0369++ 9995 83          		ADD A,E
0370++ 9996 28 25       		JR Z,PD_REL
0371++ 9998 38 AD       		JR C,PD_VOL
0372++ 999A 83          		ADD A,E
0373++ 999B 28 B3       		JR Z,PD_EOff
0374++ 999D 38 B9       		JR C,PD_SorE
0375++ 999F C6 60       		ADD A,96
0376++ 99A1 38 20       		JR C,PD_NOTE
0377++ 99A3 83          		ADD A,E
0378++ 99A4 38 C1       		JR C,PD_ORN
0379++ 99A6 82          		ADD A,D
0380++ 99A7 38 0F       		JR C,PD_NOIS
0381++ 99A9 83          		ADD A,E
0382++ 99AA 38 C0       		JR C,PD_ESAM
0383++ 99AC 87          		ADD A,A
0384++ 99AD 5F          		LD E,A
0385++ 99AE 21 E9 79    		LD HL,(SPCCOMS+$DF20) % 65536	; Adapted from original Speccy version (saves 6 bytes)
0386++ 99B1 19          		ADD HL,DE
0387++ 99B2 5E          		LD E,[HL]
0388++ 99B3 23          		INC HL
0389++ 99B4 56          		LD D,[HL]
0390++ 99B5 D5          		PUSH DE
0391++ 99B6 18 D0       		JR PD_LOOP
0392++ 99B8             
0393++ 99B8 32 7E F0    PD_NOIS: 	LD [Ns_Base],A
0394++ 99BB 18 CE       		JR PD_LP2
0395++ 99BD             
0396++ 99BD DD CB 09 86 PD_REL: 		RES 0,[IX+(CHNPRM_Flags-12)]
0397++ 99C1 18 08       		JR PD_RES
0398++ 99C3             	
0399++ 99C3 DD 77 06    PD_NOTE: 	LD [IX+(CHNPRM_Note-12)],A
0400++ 99C6 DD CB 09 C6 		SET 0,[IX+(CHNPRM_Flags-12)]
0401++ 99CA AF          		XOR A
0402++ 99CB             
0403++ 99CB ED 73 09 F0 PD_RES: 		LD [PT3_PDSP],SP
0404++ 99CF DD F9       		LD SP,IX
0405++ 99D1 67          		LD H,A
0406++ 99D2 6F          		LD L,A
0407++ 99D3 E5          		PUSH HL
0408++ 99D4 E5          		PUSH HL
0409++ 99D5 E5          		PUSH HL
0410++ 99D6 E5          		PUSH HL
0411++ 99D7 E5          		PUSH HL
0412++ 99D8 E5          		PUSH HL
0413++ 99D9 ED 7B 09 F0 		LD SP,[PT3_PDSP]
0414++ 99DD             
0415++ 99DD DD 7E 05    PD_FIN: 		LD A,[IX+(CHNPRM_NNtSkp-12)]
0416++ 99E0 DD 77 0F    		LD [IX+(CHNPRM_NtSkCn-12)],A
0417++ 99E3 C9          		RET
0418++ 99E4             
0419++ 99E4 DD CB 09 96 C_PORTM: 	RES 2,[IX+(CHNPRM_Flags-12)]
0420++ 99E8 0A          		LD A,[BC]
0421++ 99E9 03          		INC BC
0422++ 99EA             		;SKIP PRECALCULATED TONE DELTA [BECAUSE
0423++ 99EA             		;CANNOT BE RIGHT AFTER PT3 COMPILATION]
0424++ 99EA 03          		INC BC
0425++ 99EB 03          		INC BC
0426++ 99EC DD 77 0A    		LD [IX+(CHNPRM_TnSlDl-12)],A
0427++ 99EF DD 77 F9    		LD [IX+(CHNPRM_TSlCnt-12)],A
0428++ 99F2 11 80 F0    		LD DE,NT_
0429++ 99F5 DD 7E 06    		LD A,[IX+(CHNPRM_Note-12)]
0430++ 99F8 DD 77 07    		LD [IX+(CHNPRM_SlToNt-12)],A
0431++ 99FB 87          		ADD A,A
0432++ 99FC 6F          		LD L,A
0433++ 99FD 26 00       		LD H,0
0434++ 99FF 19          		ADD HL,DE
0435++ 9A00 7E          		LD A,[HL]
0436++ 9A01 23          		INC HL
0437++ 9A02 66          		LD H,[HL]
0438++ 9A03 6F          		LD L,A
0439++ 9A04 E5          		PUSH HL
0440++ 9A05 3A 0F F0    		LD A,[PT3_PrNote]
0441++ 9A08 DD 77 06    		LD [IX+(CHNPRM_Note-12)],A
0442++ 9A0B 87          		ADD A,A
0443++ 9A0C 6F          		LD L,A
0444++ 9A0D 26 00       		LD H,0
0445++ 9A0F 19          		ADD HL,DE
0446++ 9A10 5E          		LD E,[HL]
0447++ 9A11 23          		INC HL
0448++ 9A12 56          		LD D,[HL]
0449++ 9A13 E1          		POP HL
0450++ 9A14 ED 52       		SBC HL,DE
0451++ 9A16 DD 75 0D    		LD [IX+(CHNPRM_TnDelt-12)],L
0452++ 9A19 DD 74 0E    		LD [IX+(CHNPRM_TnDelt+1-12)],H
0453++ 9A1C ED 5B 10 F0 		LD DE,[PT3_PrSlide]
0454++ 9A20 DD 73 FA    		LD [IX+(CHNPRM_CrTnSl-12)],E
0455++ 9A23 DD 72 FB    		LD [IX+(CHNPRM_CrTnSl+1-12)],D
0456++ 9A26 0A          		LD A,[BC] ;SIGNED TONE STEP
0457++ 9A27 03          		INC BC
0458++ 9A28 08          		EX AF,AF'
0459++ 9A29 0A          		LD A,[BC]
0460++ 9A2A 03          		INC BC
0461++ 9A2B A7          		AND A
0462++ 9A2C 28 01       		JR Z,.NOSIG
0463++ 9A2E EB          		EX DE,HL
0464++ 9A2F ED 52       .NOSIG: 	SBC HL,DE
0465++ 9A31 F2 39 9A    		JP P,SET_STP
0466++ 9A34 2F          		CPL
0467++ 9A35 08          		EX AF,AF'
0468++ 9A36 ED 44       		NEG
0469++ 9A38 08          		EX AF,AF'
0470++ 9A39 DD 77 0C    SET_STP: 	LD [IX+(CHNPRM_TSlStp+1-12)],A
0471++ 9A3C 08          		EX AF,AF'
0472++ 9A3D DD 77 0B    		LD [IX+(CHNPRM_TSlStp-12)],A
0473++ 9A40 DD 36 FE 00 		LD [IX+(CHNPRM_COnOff-12)],0
0474++ 9A44 C9          		RET
0475++ 9A45             
0476++ 9A45 DD CB 09 D6 C_GLISS: 	SET 2,[IX+(CHNPRM_Flags-12)]
0477++ 9A49 0A          		LD A,[BC]
0478++ 9A4A 03          		INC BC
0479++ 9A4B DD 77 0A    		LD [IX+(CHNPRM_TnSlDl-12)],A
0480++ 9A4E DD 77 F9    		LD [IX+(CHNPRM_TSlCnt-12)],A
0481++ 9A51 0A          		LD A,[BC]
0482++ 9A52 03          		INC BC
0483++ 9A53 08          		EX AF,AF'
0484++ 9A54 0A          		LD A,[BC]
0485++ 9A55 03          		INC BC
0486++ 9A56 18 E1       		JR SET_STP
0487++ 9A58             
0488++ 9A58 0A          C_SMPOS: 	LD A,[BC]
0489++ 9A59 03          		INC BC
0490++ 9A5A DD 77 F5    		LD [IX+(CHNPRM_PsInSm-12)],A
0491++ 9A5D C9          		RET
0492++ 9A5E             
0493++ 9A5E 0A          C_ORPOS: 	LD A,[BC]
0494++ 9A5F 03          		INC BC
0495++ 9A60 DD 77 F4    		LD [IX+(CHNPRM_PsInOr-12)],A
0496++ 9A63 C9          		RET
0497++ 9A64             
0498++ 9A64 0A          C_VIBRT: 	LD A,[BC]
0499++ 9A65 03          		INC BC
0500++ 9A66 DD 77 FF    		LD [IX+(CHNPRM_OnOffD-12)],A
0501++ 9A69 DD 77 FE    		LD [IX+(CHNPRM_COnOff-12)],A
0502++ 9A6C 0A          		LD A,[BC]
0503++ 9A6D 03          		INC BC
0504++ 9A6E DD 77 00    		LD [IX+(CHNPRM_OffOnD-12)],A
0505++ 9A71 AF          		XOR A
0506++ 9A72 DD 77 F9    		LD [IX+(CHNPRM_TSlCnt-12)],A
0507++ 9A75 DD 77 FA    		LD [IX+(CHNPRM_CrTnSl-12)],A
0508++ 9A78 DD 77 FB    		LD [IX+(CHNPRM_CrTnSl+1-12)],A
0509++ 9A7B C9          		RET
0510++ 9A7C             
0511++ 9A7C 0A          C_ENGLS: 	LD A,[BC]
0512++ 9A7D 03          		INC BC
0513++ 9A7E 32 1E F0    		LD [PT3_Env_Del],A
0514++ 9A81 32 7D F0    		LD [CurEDel],A
0515++ 9A84 0A          		LD A,[BC]
0516++ 9A85 03          		INC BC
0517++ 9A86 6F          		LD L,A
0518++ 9A87 0A          		LD A,[BC]
0519++ 9A88 03          		INC BC
0520++ 9A89 67          		LD H,A
0521++ 9A8A 22 1F F0    		LD [PT3_ESldAdd],HL
0522++ 9A8D C9          		RET
0523++ 9A8E             
0524++ 9A8E 0A          C_DELAY: 	LD A,[BC]
0525++ 9A8F 03          		INC BC
0526++ 9A90 32 1C F0    		LD [PT3_Delay],A
0527++ 9A93 C9          		RET
0528++ 9A94             	
0529++ 9A94 DD 73 08    SETENV: 		LD [IX+(CHNPRM_Env_En-12)],E
0530++ 9A97 32 4D F1    		LD [AYREGS+AR_EnvTp],A
0531++ 9A9A 0A          		LD A,[BC]
0532++ 9A9B 03          		INC BC
0533++ 9A9C 67          		LD H,A
0534++ 9A9D 0A          		LD A,[BC]
0535++ 9A9E 03          		INC BC
0536++ 9A9F 6F          		LD L,A
0537++ 9AA0 22 4E F1    		LD [EnvBase],HL
0538++ 9AA3 AF          		XOR A
0539++ 9AA4 DD 77 F4    		LD [IX+(CHNPRM_PsInOr-12)],A
0540++ 9AA7 32 7D F0    		LD [CurEDel],A
0541++ 9AAA 67          		LD H,A
0542++ 9AAB 6F          		LD L,A
0543++ 9AAC 22 7B F0    		LD [CurESld],HL
0544++ 9AAF C9          C_NOP: 		RET
0545++ 9AB0             
0546++ 9AB0 87          SETORN: 		ADD A,A
0547++ 9AB1 5F          		LD E,A
0548++ 9AB2 16 00       		LD D,0
0549++ 9AB4 DD 72 F4    		LD [IX+(CHNPRM_PsInOr-12)],D
0550++ 9AB7 2A 07 F0    		LD HL,[PT3_OrnPtrs]
0551++ 9ABA 19          		ADD HL,DE
0552++ 9ABB 5E          		LD E,[HL]
0553++ 9ABC 23          		INC HL
0554++ 9ABD 56          		LD D,[HL]
0555++ 9ABE 2A 01 F0    		LD HL,[PT3_MODADDR]
0556++ 9AC1 19          		ADD HL,DE
0557++ 9AC2 DD 75 01    		LD [IX+(CHNPRM_OrnPtr-12)],L
0558++ 9AC5 DD 74 02    		LD [IX+(CHNPRM_OrnPtr+1-12)],H
0559++ 9AC8 C9          		RET
0560++ 9AC9             
0561++ 9AC9             		;ALL 16 ADDRESSES TO PROTECT FROM BROKEN PT3 MODULES
0562++ 9AC9 AF 9A       SPCCOMS: 	dw C_NOP
0563++ 9ACB 45 9A       		dw C_GLISS
0564++ 9ACD E4 99       		dw C_PORTM
0565++ 9ACF 58 9A       		dw C_SMPOS
0566++ 9AD1 5E 9A       		dw C_ORPOS
0567++ 9AD3 64 9A       		dw C_VIBRT
0568++ 9AD5 AF 9A       		dw C_NOP
0569++ 9AD7 AF 9A       		dw C_NOP
0570++ 9AD9 7C 9A       		dw C_ENGLS
0571++ 9ADB 8E 9A       		dw C_DELAY
0572++ 9ADD AF 9A       		dw C_NOP
0573++ 9ADF AF 9A       		dw C_NOP
0574++ 9AE1 AF 9A       		dw C_NOP
0575++ 9AE3 AF 9A       		dw C_NOP
0576++ 9AE5 AF 9A       		dw C_NOP
0577++ 9AE7 AF 9A       		dw C_NOP
0578++ 9AE9             
0579++ 9AE9 AF          CHREGS: 		XOR A
0580++ 9AEA 32 4A F1    		LD [AYREGS+AR_AmplC],A
0581++ 9AED DD CB 15 46 		BIT 0,[IX+CHNPRM_Flags]
0582++ 9AF1 E5          		PUSH HL
0583++ 9AF2 CA 18 9C    		JP Z,.CH_EXIT
0584++ 9AF5 ED 73 0B F0 		LD [PT3_CSP],SP
0585++ 9AF9 DD 6E 0D    		LD L,[IX+CHNPRM_OrnPtr]
0586++ 9AFC DD 66 0E    		LD H,[IX+CHNPRM_OrnPtr+1]
0587++ 9AFF F9          		LD SP,HL
0588++ 9B00 D1          		POP DE
0589++ 9B01 67          		LD H,A
0590++ 9B02 DD 7E 00    		LD A,[IX+CHNPRM_PsInOr]
0591++ 9B05 6F          		LD L,A
0592++ 9B06 39          		ADD HL,SP
0593++ 9B07 3C          		INC A
0594++ 9B08 BA          		CP D
0595++ 9B09 38 01       		JR C,.CH_ORPS
0596++ 9B0B 7B          		LD A,E
0597++ 9B0C DD 77 00    .CH_ORPS: 	LD [IX+CHNPRM_PsInOr],A
0598++ 9B0F DD 7E 12    		LD A,[IX+CHNPRM_Note]
0599++ 9B12 86          		ADD A,[HL]
0600++ 9B13 F2 17 9B    		JP P,.CH_NTP
0601++ 9B16 AF          		XOR A
0602++ 9B17 FE 60       .CH_NTP: 	CP 96
0603++ 9B19 38 02       		JR C,.CH_NOK
0604++ 9B1B 3E 5F       		LD A,95
0605++ 9B1D 87          .CH_NOK: 	ADD A,A
0606++ 9B1E 08          		EX AF,AF'
0607++ 9B1F DD 6E 0F    		LD L,[IX+CHNPRM_SamPtr]
0608++ 9B22 DD 66 10    		LD H,[IX+CHNPRM_SamPtr+1]
0609++ 9B25 F9          		LD SP,HL
0610++ 9B26 D1          		POP DE
0611++ 9B27 26 00       		LD H,0
0612++ 9B29 DD 7E 01    		LD A,[IX+CHNPRM_PsInSm]
0613++ 9B2C 47          		LD B,A
0614++ 9B2D 87          		ADD A,A
0615++ 9B2E 87          		ADD A,A
0616++ 9B2F 6F          		LD L,A
0617++ 9B30 39          		ADD HL,SP
0618++ 9B31 F9          		LD SP,HL
0619++ 9B32 78          		LD A,B
0620++ 9B33 3C          		INC A
0621++ 9B34 BA          		CP D
0622++ 9B35 38 01       		JR C,.CH_SMPS
0623++ 9B37 7B          		LD A,E
0624++ 9B38 DD 77 01    .CH_SMPS: 	LD [IX+CHNPRM_PsInSm],A
0625++ 9B3B C1          		POP BC
0626++ 9B3C E1          		POP HL
0627++ 9B3D DD 5E 08    		LD E,[IX+CHNPRM_TnAcc]
0628++ 9B40 DD 56 09    		LD D,[IX+CHNPRM_TnAcc+1]
0629++ 9B43 19          		ADD HL,DE
0630++ 9B44 CB 70       		BIT 6,B
0631++ 9B46 28 06       		JR Z,.CH_NOAC
0632++ 9B48 DD 75 08    		LD [IX+CHNPRM_TnAcc],L
0633++ 9B4B DD 74 09    		LD [IX+CHNPRM_TnAcc+1],H
0634++ 9B4E EB          .CH_NOAC: 	EX DE,HL
0635++ 9B4F 08          		EX AF,AF'
0636++ 9B50 6F          		LD L,A
0637++ 9B51 26 00       		LD H,0
0638++ 9B53 31 80 F0    		LD SP,NT_
0639++ 9B56 39          		ADD HL,SP
0640++ 9B57 F9          		LD SP,HL
0641++ 9B58 E1          		POP HL
0642++ 9B59 19          		ADD HL,DE
0643++ 9B5A DD 5E 06    		LD E,[IX+CHNPRM_CrTnSl]
0644++ 9B5D DD 56 07    		LD D,[IX+CHNPRM_CrTnSl+1]
0645++ 9B60 19          		ADD HL,DE
0646++ 9B61 ED 7B 0B F0 		LD SP,[PT3_CSP]
0647++ 9B65 E3          		EX [SP],HL
0648++ 9B66 AF          		XOR A
0649++ 9B67 DD B6 05    		OR [IX+CHNPRM_TSlCnt]
0650++ 9B6A 28 3E       		JR Z,.CH_AMP
0651++ 9B6C DD 35 05    		DEC [IX+CHNPRM_TSlCnt]
0652++ 9B6F 20 39       		JR NZ,.CH_AMP
0653++ 9B71 DD 7E 16    		LD A,[IX+CHNPRM_TnSlDl]
0654++ 9B74 DD 77 05    		LD [IX+CHNPRM_TSlCnt],A
0655++ 9B77 DD 6E 17    		LD L,[IX+CHNPRM_TSlStp]
0656++ 9B7A DD 66 18    		LD H,[IX+CHNPRM_TSlStp+1]
0657++ 9B7D 7C          		LD A,H
0658++ 9B7E 19          		ADD HL,DE
0659++ 9B7F DD 75 06    		LD [IX+CHNPRM_CrTnSl],L
0660++ 9B82 DD 74 07    		LD [IX+CHNPRM_CrTnSl+1],H
0661++ 9B85 DD CB 15 56 		BIT 2,[IX+CHNPRM_Flags]
0662++ 9B89 20 1F       		JR NZ,.CH_AMP
0663++ 9B8B DD 5E 19    		LD E,[IX+CHNPRM_TnDelt]
0664++ 9B8E DD 56 1A    		LD D,[IX+CHNPRM_TnDelt+1]
0665++ 9B91 A7          		AND A
0666++ 9B92 28 01       		JR Z,.CH_STPP
0667++ 9B94 EB          		EX DE,HL
0668++ 9B95 ED 52       .CH_STPP: 	SBC HL,DE
0669++ 9B97 FA AA 9B    		JP M,.CH_AMP
0670++ 9B9A DD 7E 13    		LD A,[IX+CHNPRM_SlToNt]
0671++ 9B9D DD 77 12    		LD [IX+CHNPRM_Note],A
0672++ 9BA0 AF          		XOR A
0673++ 9BA1 DD 77 05    		LD [IX+CHNPRM_TSlCnt],A
0674++ 9BA4 DD 77 06    		LD [IX+CHNPRM_CrTnSl],A
0675++ 9BA7 DD 77 07    		LD [IX+CHNPRM_CrTnSl+1],A
0676++ 9BAA DD 7E 02    .CH_AMP: 	LD A,[IX+CHNPRM_CrAmSl]
0677++ 9BAD CB 79       		BIT 7,C
0678++ 9BAF 28 13       		JR Z,.CH_NOAM
0679++ 9BB1 CB 71       		BIT 6,C
0680++ 9BB3 28 07       		JR Z,.CH_AMIN
0681++ 9BB5 FE 0F       		CP 15
0682++ 9BB7 28 0B       		JR Z,.CH_NOAM
0683++ 9BB9 3C          		INC A
0684++ 9BBA 18 05       		JR .CH_SVAM
0685++ 9BBC FE F1       .CH_AMIN: 	CP -15
0686++ 9BBE 28 04       		JR Z,.CH_NOAM
0687++ 9BC0 3D          		DEC A
0688++ 9BC1 DD 77 02    .CH_SVAM: 	LD [IX+CHNPRM_CrAmSl],A
0689++ 9BC4 6F          .CH_NOAM: 	LD L,A
0690++ 9BC5 78          		LD A,B
0691++ 9BC6 E6 0F       		AND 15
0692++ 9BC8 85          		ADD A,L
0693++ 9BC9 F2 CD 9B    		JP P,.CH_APOS
0694++ 9BCC AF          		XOR A
0695++ 9BCD FE 10       .CH_APOS: 	CP 16
0696++ 9BCF 38 02       		JR C,.CH_VOL
0697++ 9BD1 3E 0F       		LD A,15
0698++ 9BD3 DD B6 1C    .CH_VOL: 	OR [IX+CHNPRM_Volume]
0699++ 9BD6 6F          		LD L,A
0700++ 9BD7 26 00       		LD H,0
0701++ 9BD9 11 40 F1    		LD DE,VT_
0702++ 9BDC 19          		ADD HL,DE
0703++ 9BDD 7E          		LD A,[HL]
0704++ 9BDE CB 41       .CH_ENV: 	BIT 0,C
0705++ 9BE0 20 03       		JR NZ,.CH_NOEN
0706++ 9BE2 DD B6 14    		OR [IX+CHNPRM_Env_En]
0707++ 9BE5 32 4A F1    .CH_NOEN: 	LD [AYREGS+AR_AmplC],A
0708++ 9BE8 CB 78       		BIT 7,B
0709++ 9BEA 79          		LD A,C
0710++ 9BEB 28 19       		JR Z,.NO_ENSL
0711++ 9BED 17          		RLA
0712++ 9BEE 17          		RLA
0713++ 9BEF CB 2F       		SRA A
0714++ 9BF1 CB 2F       		SRA A
0715++ 9BF3 CB 2F       		SRA A
0716++ 9BF5 DD 86 04    		ADD A,[IX+CHNPRM_CrEnSl] ;SEE COMMENT BELOW
0717++ 9BF8 CB 68       		BIT 5,B
0718++ 9BFA 28 03       		JR Z,.NO_ENAC
0719++ 9BFC DD 77 04    		LD [IX+CHNPRM_CrEnSl],A
0720++ 9BFF 21 1D F0    .NO_ENAC: 	LD HL,PT3_AddToEn
0721++ 9C02 86          		ADD A,[HL] ;BUG IN PT3 - NEED WORD HERE.
0722++ 9C03             			   ;FIX IT IN NEXT VERSION?
0723++ 9C03 77          		LD [HL],A
0724++ 9C04 18 0E       		JR .CH_MIX
0725++ 9C06 1F          .NO_ENSL: 	RRA
0726++ 9C07 DD 86 03    		ADD A,[IX+CHNPRM_CrNsSl]
0727++ 9C0A 32 7F F0    		LD [AddToNs],A
0728++ 9C0D CB 68       		BIT 5,B
0729++ 9C0F 28 03       		JR Z,.CH_MIX
0730++ 9C11 DD 77 03    		LD [IX+CHNPRM_CrNsSl],A
0731++ 9C14 78          .CH_MIX: 	LD A,B
0732++ 9C15 1F          		RRA
0733++ 9C16 E6 48       		AND $48
0734++ 9C18 21 47 F1    .CH_EXIT: 	LD HL,AYREGS+AR_Mixer
0735++ 9C1B B6          		OR [HL]
0736++ 9C1C 0F          		RRCA
0737++ 9C1D 77          		LD [HL],A
0738++ 9C1E E1          		POP HL
0739++ 9C1F AF          		XOR A
0740++ 9C20 DD B6 0A    		OR [IX+CHNPRM_COnOff]
0741++ 9C23 C8          		RET Z
0742++ 9C24 DD 35 0A    		DEC [IX+CHNPRM_COnOff]
0743++ 9C27 C0          		RET NZ
0744++ 9C28 DD AE 15    		XOR [IX+CHNPRM_Flags]
0745++ 9C2B DD 77 15    		LD [IX+CHNPRM_Flags],A
0746++ 9C2E 1F          		RRA
0747++ 9C2F DD 7E 0B    		LD A,[IX+CHNPRM_OnOffD]
0748++ 9C32 38 03       		JR C,.CH_ONDL
0749++ 9C34 DD 7E 0C    		LD A,[IX+CHNPRM_OffOnD]
0750++ 9C37 DD 77 0A    .CH_ONDL: 	LD [IX+CHNPRM_COnOff],A
0751++ 9C3A C9          		RET
0752++ 9C3B             
0753++ 9C3B AF          PT3_PLAY: 	XOR A
0754++ 9C3C 32 1D F0    		LD [PT3_AddToEn],A
0755++ 9C3F 32 47 F1    		LD [AYREGS+AR_Mixer],A
0756++ 9C42 3D          		DEC A
0757++ 9C43 32 4D F1    		LD [AYREGS+AR_EnvTp],A
0758++ 9C46 21 7A F0    		LD HL,DelyCnt
0759++ 9C49 35          		DEC [HL]
0760++ 9C4A C2 D1 9C    		JP NZ,.PL2
0761++ 9C4D 21 3E F0    		LD HL,ChanA+CHNPRM_NtSkCn
0762++ 9C50 35          		DEC [HL]
0763++ 9C51 20 4E       		JR NZ,.PL1B
0764++ 9C53 ED 4B 12 F0 		LD BC,[PT3_AdInPtA]
0765++ 9C57 0A          		LD A,[BC]
0766++ 9C58 A7          		AND A
0767++ 9C59 20 3B       		JR NZ,.PL1A
0768++ 9C5B 57          		LD D,A
0769++ 9C5C 32 7E F0    		LD [Ns_Base],A
0770++ 9C5F 2A 03 F0    		LD HL,[PT3_CrPsPtr]
0771++ 9C62 23          		INC HL
0772++ 9C63 7E          		LD A,[HL]
0773++ 9C64 3C          		INC A
0774++ 9C65 20 08       		JR NZ,.PLNLP
0775++ 9C67 CD D1 97    		CALL CHECKLP
0776++ 9C6A 2A 18 F0    		LD HL,[PT3_LPosPtr]
0777++ 9C6D 7E          		LD A,[HL]
0778++ 9C6E 3C          		INC A
0779++ 9C6F 22 03 F0    .PLNLP: 	LD [PT3_CrPsPtr],HL
0780++ 9C72 3D          		DEC A
0781++ 9C73 87          		ADD A,A
0782++ 9C74 5F          		LD E,A
0783++ 9C75 CB 12       		RL D
0784++ 9C77 2A 1A F0    		LD HL,[PT3_PatsPtr]
0785++ 9C7A 19          		ADD HL,DE
0786++ 9C7B ED 5B 01 F0 		LD DE,[PT3_MODADDR]
0787++ 9C7F ED 73 0D F0 		LD [PT3_PSP],SP
0788++ 9C83 F9          		LD SP,HL
0789++ 9C84 E1          		POP HL
0790++ 9C85 19          		ADD HL,DE
0791++ 9C86 44          		LD B,H
0792++ 9C87 4D          		LD C,L
0793++ 9C88 E1          		POP HL
0794++ 9C89 19          		ADD HL,DE
0795++ 9C8A 22 14 F0    		LD [PT3_AdInPtB],HL
0796++ 9C8D E1          		POP HL
0797++ 9C8E 19          		ADD HL,DE
0798++ 9C8F 22 16 F0    		LD [PT3_AdInPtC],HL
0799++ 9C92 ED 7B 0D F0 		LD SP,[PT3_PSP]
0800++ 9C96             
0801++ 9C96 DD 21 2F F0 .PL1A: 		LD IX,ChanA+12
0802++ 9C9A CD 79 99    		CALL PTDECOD
0803++ 9C9D ED 43 12 F0 		LD [PT3_AdInPtA],BC
0804++ 9CA1             
0805++ 9CA1 21 5B F0    .PL1B: 		LD HL,ChanB+CHNPRM_NtSkCn
0806++ 9CA4 35          		DEC [HL]
0807++ 9CA5 20 0F       		JR NZ,.PL1C
0808++ 9CA7 DD 21 4C F0 		LD IX,ChanB+12
0809++ 9CAB ED 4B 14 F0 		LD BC,[PT3_AdInPtB]
0810++ 9CAF CD 79 99    		CALL PTDECOD
0811++ 9CB2 ED 43 14 F0 		LD [PT3_AdInPtB],BC
0812++ 9CB6             
0813++ 9CB6 21 78 F0    .PL1C: 		LD HL,ChanC+CHNPRM_NtSkCn
0814++ 9CB9 35          		DEC [HL]
0815++ 9CBA 20 0F       		JR NZ,.PL1D
0816++ 9CBC DD 21 69 F0 		LD IX,ChanC+12
0817++ 9CC0 ED 4B 16 F0 		LD BC,[PT3_AdInPtC]
0818++ 9CC4 CD 79 99    		CALL PTDECOD
0819++ 9CC7 ED 43 16 F0 		LD [PT3_AdInPtC],BC
0820++ 9CCB             
0821++ 9CCB 3A 1C F0    .PL1D: 		LD A,[PT3_Delay]
0822++ 9CCE 32 7A F0    		LD [DelyCnt],A
0823++ 9CD1             
0824++ 9CD1 DD 21 23 F0 .PL2: 		LD IX,ChanA
0825++ 9CD5 2A 40 F1    		LD HL,[AYREGS+AR_TonA]
0826++ 9CD8 CD E9 9A    		CALL CHREGS
0827++ 9CDB 22 40 F1    		LD [AYREGS+AR_TonA],HL
0828++ 9CDE 3A 4A F1    		LD A,[AYREGS+AR_AmplC]
0829++ 9CE1 32 48 F1    		LD [AYREGS+AR_AmplA],A
0830++ 9CE4 DD 21 40 F0 		LD IX,ChanB
0831++ 9CE8 2A 42 F1    		LD HL,[AYREGS+AR_TonB]
0832++ 9CEB CD E9 9A    		CALL CHREGS
0833++ 9CEE 22 42 F1    		LD [AYREGS+AR_TonB],HL
0834++ 9CF1 3A 4A F1    		LD A,[AYREGS+AR_AmplC]
0835++ 9CF4 32 49 F1    		LD [AYREGS+AR_AmplB],A
0836++ 9CF7 DD 21 5D F0 		LD IX,ChanC
0837++ 9CFB 2A 44 F1    		LD HL,[AYREGS+AR_TonC]
0838++ 9CFE CD E9 9A    		CALL CHREGS
0839++ 9D01 22 44 F1    		LD [AYREGS+AR_TonC],HL
0840++ 9D04             
0841++ 9D04 2A 7E F0    		LD HL,[Ns_Base_AddToNs]
0842++ 9D07 7C          		LD A,H
0843++ 9D08 85          		ADD A,L
0844++ 9D09 32 46 F1    		LD [AYREGS+AR_Noise],A
0845++ 9D0C             
0846++ 9D0C 3A 1D F0    		LD A,[PT3_AddToEn]
0847++ 9D0F 5F          		LD E,A
0848++ 9D10 87          		ADD A,A
0849++ 9D11 9F          		SBC A,A
0850++ 9D12 57          		LD D,A
0851++ 9D13 2A 4E F1    		LD HL,[EnvBase]
0852++ 9D16 19          		ADD HL,DE
0853++ 9D17 ED 5B 7B F0 		LD DE,[CurESld]
0854++ 9D1B 19          		ADD HL,DE
0855++ 9D1C 22 4B F1    		LD [AYREGS+AR_Env],HL
0856++ 9D1F             
0857++ 9D1F AF          		XOR A
0858++ 9D20 21 7D F0    		LD HL,CurEDel
0859++ 9D23 B6          		OR [HL]
0860++ 9D24 C8          		RET Z
0861++ 9D25 35          		DEC [HL]
0862++ 9D26 C0          		RET NZ
0863++ 9D27 3A 1E F0    		LD A,[PT3_Env_Del]
0864++ 9D2A 77          		LD [HL],A
0865++ 9D2B 2A 1F F0    		LD HL,[PT3_ESldAdd]
0866++ 9D2E 19          		ADD HL,DE
0867++ 9D2F 22 7B F0    		LD [CurESld],HL
0868++ 9D32 C9          		RET
0869++ 9D33             
0870++ 9D33 AF          PT3_ROUT: 	XOR A
0871++ 9D34             	
0872++ 9D34             ROUT_A0: 	; --- FIXES BITS 6 AND 7 OF MIXER ---
0873++ 9D34 21 47 F1    		LD	HL,AYREGS+AR_Mixer
0874++ 9D37 CB FE       		set	7,[hl]
0875++ 9D39 CB B6       		res	6,[hl]
0876++ 9D3B             
0877++ 9D3B 0E A0       		LD C,$A0
0878++ 9D3D 21 40 F1    		LD HL,AYREGS
0879++ 9D40 ED 79       .LOUT: 		OUT [C],A
0880++ 9D42 0C          		INC C
0881++ 9D43 ED A3       		OUTI 
0882++ 9D45 0D          		DEC C
0883++ 9D46 3C          		INC A
0884++ 9D47 FE 0D       		CP 13
0885++ 9D49 20 F5       		JR NZ,.LOUT
0886++ 9D4B ED 79       		OUT [C],A
0887++ 9D4D 7E          		LD A,[HL]
0888++ 9D4E A7          		AND A
0889++ 9D4F F8          		RET M
0890++ 9D50 0C          		INC C
0891++ 9D51 ED 79       		OUT [C],A
0892++ 9D53 C9          		RET
0893++ 9D54             
0894++ 9D54 64          NT_DATA: 	db (T_NEW_0-T1_)*2
0895++ 9D55 2A          		db TCNEW_0-T_
0896++ 9D56 65          		db (T_OLD_0-T1_)*2+1
0897++ 9D57 00          		db TCOLD_0-T_
0898++ 9D58 01          		db (T_NEW_1-T1_)*2+1
0899++ 9D59 0C          		db TCNEW_1-T_
0900++ 9D5A 01          		db (T_OLD_1-T1_)*2+1
0901++ 9D5B 0C          		db TCOLD_1-T_
0902++ 9D5C 94          		db (T_NEW_2-T1_)*2
0903++ 9D5D 35          		db TCNEW_2-T_
0904++ 9D5E 30          		db (T_OLD_2-T1_)*2
0905++ 9D5F 0E          		db TCOLD_2-T_
0906++ 9D60 60          		db (T_NEW_3-T1_)*2
0907++ 9D61 20          		db TCNEW_3-T_
0908++ 9D62 60          		db (T_OLD_3-T1_)*2
0909++ 9D63 21          		db TCOLD_3-T_
0910++ 9D64             
0911++ 9D64             T_: 
0912++ 9D64             
0913++ 9D64             TCOLD_0: 	db $00+1,$04+1,$08+1,$0A+1,$0C+1,$0E+1,$12+1,$14+1
0913++ 9D64 0105090B0D0F1315
0914++ 9D6C 19 25 3D 00 		db $18+1,$24+1,$3C+1,0
0915++ 9D70             TCNEW_1: 	
0916++ 9D70 5D 00       TCOLD_1: 	db $5C+1,0
0917++ 9D72             TCOLD_2: 	db $30+1,$36+1,$4C+1,$52+1,$5E+1,$70+1,$82,$8C,$9C
0917++ 9D72 31374D535F71828C9C
0918++ 9D7B             		db $9E,$A0,$A6,$A8,$AA,$AC,$AE,$AE,0
0918++ 9D7B 9EA0A6A8AAACAEAE00
0919++ 9D84 57          TCNEW_3: 	db $56+1
0920++ 9D85             TCOLD_3: 	db $1E+1,$22+1,$24+1,$28+1,$2C+1,$2E+1,$32+1,$BE+1,0
0920++ 9D85 1F2325292D2F33BF00
0921++ 9D8E             TCNEW_0: 	db $1C+1,$20+1,$22+1,$26+1,$2A+1,$2C+1,$30+1,$54+1
0921++ 9D8E 1D2123272B2D3155
0922++ 9D96 BD BF 00    		db $BC+1,$BE+1,0
0923++ 9D99             TCNEW_2: 	db $1A+1,$20+1,$24+1,$28+1,$2A+1,$3A+1,$4C+1,$5E+1
0923++ 9D99 1B2125292B3B4D5F
0924++ 9DA1 BB BD BF    		db $BA+1,$BC+1,$BE+1
0925++ 9DA4             
0926++ 9DA4 00 01 00 90 EMPTYSAMORN:  	db 0,1,0,$90 ;delete $90 if you don't need default sample
0927++ 9DA8             
0928++ 9DA8             T_PACK: 		; First 12 values of tone tables (packed)
0929++ 9DA8 0D          		db ($06EC*2)/256
0930++ 9DA9 D8          		db #d8
0931++ 9DAA 69          		db $0755-$06EC
0932++ 9DAB 70          		db $07C5-$0755
0933++ 9DAC 76          		db $083B-$07C5
0934++ 9DAD 7D          		db $08B8-$083B
0935++ 9DAE 85          		db $093D-$08B8
0936++ 9DAF 8D          		db $09CA-$093D
0937++ 9DB0 95          		db $0A5F-$09CA
0938++ 9DB1 9D          		db $0AFC-$0A5F
0939++ 9DB2 A8          		db $0BA4-$0AFC
0940++ 9DB3 B1          		db $0C55-$0BA4
0941++ 9DB4 BB          		db $0D10-$0C55
0942++ 9DB5 0C          		db ($066D*2)/256
0943++ 9DB6 DA          		db #da
0944++ 9DB7 62          		db $06CF-$066D
0945++ 9DB8 68          		db $0737-$06CF
0946++ 9DB9 6D          		db $07A4-$0737
0947++ 9DBA 75          		db $0819-$07A4
0948++ 9DBB 7B          		db $0894-$0819
0949++ 9DBC 83          		db $0917-$0894
0950++ 9DBD 8A          		db $09A1-$0917
0951++ 9DBE 92          		db $0A33-$09A1
0952++ 9DBF 9C          		db $0ACF-$0A33
0953++ 9DC0 A4          		db $0B73-$0ACF
0954++ 9DC1 AF          		db $0C22-$0B73
0955++ 9DC2 B8          		db $0CDA-$0C22
0956++ 9DC3 0E          		db ($0704*2)/256
0957++ 9DC4 08          		db #08
0958++ 9DC5 6A          		db $076E-$0704
0959++ 9DC6 72          		db $07E0-$076E
0960++ 9DC7 78          		db $0858-$07E0
0961++ 9DC8 7E          		db $08D6-$0858
0962++ 9DC9 86          		db $095C-$08D6
0963++ 9DCA 90          		db $09EC-$095C
0964++ 9DCB 96          		db $0A82-$09EC
0965++ 9DCC A0          		db $0B22-$0A82
0966++ 9DCD AA          		db $0BCC-$0B22
0967++ 9DCE B4          		db $0C80-$0BCC
0968++ 9DCF BE          		db $0D3E-$0C80
0969++ 9DD0 0F          		db ($07E0*2)/256
0970++ 9DD1 C0          		db #c0
0971++ 9DD2 78          		db $0858-$07E0
0972++ 9DD3 88          		db $08E0-$0858
0973++ 9DD4 80          		db $0960-$08E0
0974++ 9DD5 90          		db $09F0-$0960
0975++ 9DD6 98          		db $0A88-$09F0
0976++ 9DD7 A0          		db $0B28-$0A88
0977++ 9DD8 B0          		db $0BD8-$0B28
0978++ 9DD9 A8          		db $0C80-$0BD8
0979++ 9DDA E0          		db $0D60-$0C80
0980++ 9DDB B0          		db $0E10-$0D60
0981++ 9DDC E8          		db $0EF8-$0E10
0982++ 9DDD             
0983++ 9DDD             	;Variables del replayer... las coloco desde aqui.
0984++ 9DDD             	;mirar que hace la directiva MAP del SJASM
0985++ 9DDD             	map		#f000
0986++ 9DDD             
0987++ 9DDD             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;PT3 REPLAYER
0988++ 9DDD             PT3_SETUP: 		#1	;set bit0 to 1, if you want to play without looping
0989++ 9DDD             					;bit7 is set each time, when loop point is passed
0990++ 9DDD             PT3_MODADDR: 	#2
0991++ 9DDD             PT3_CrPsPtr: 		#2
0992++ 9DDD             PT3_SAMPTRS: 		#2
0993++ 9DDD             PT3_OrnPtrs: 		#2
0994++ 9DDD             PT3_PDSP: 		#2
0995++ 9DDD             PT3_CSP: 		#2 
0996++ 9DDD             PT3_PSP: 		#2
0997++ 9DDD             PT3_PrNote: 		#1
0998++ 9DDD             PT3_PrSlide: 		#2
0999++ 9DDD             PT3_AdInPtA: 		#2
1000++ 9DDD             PT3_AdInPtB: 		#2
1001++ 9DDD             PT3_AdInPtC: 		#2
1002++ 9DDD             PT3_LPosPtr: 		#2
1003++ 9DDD             PT3_PatsPtr: 		#2
1004++ 9DDD             PT3_Delay: 		#1
1005++ 9DDD             PT3_AddToEn: 		#1
1006++ 9DDD             PT3_Env_Del: 		#1
1007++ 9DDD             PT3_ESldAdd: 		#2
1008++ 9DDD             PT3_NTL3: 		#2	; AND A / NOP (note table creator)
1009++ 9DDD             
1010++ 9DDD             VARS: 			#0
1011++ 9DDD             
1012++ 9DDD             ChanA: 			#29			;CHNPRM_Size
1013++ 9DDD             ChanB: 			#29			;CHNPRM_Size
1014++ 9DDD             ChanC: 			#29			;CHNPRM_Size
1015++ 9DDD             
1016++ 9DDD             ;GlobalVars
1017++ 9DDD             DelyCnt: 		#1
1018++ 9DDD             CurESld: 		#2
1019++ 9DDD             CurEDel: 		#1
1020++ 9DDD             Ns_Base_AddToNs: 	#0
1021++ 9DDD             Ns_Base: 		#1
1022++ 9DDD             AddToNs: 		#1
1023++ 9DDD             
1024++ 9DDD             NT_: 			#192	; Puntero a/tabla de frecuencias
1025++ 9DDD             
1026++ 9DDD             AYREGS: 			#0
1027++ 9DDD             VT_: 			#14
1028++ 9DDD             EnvBase: 		#2
1029++ 9DDD             VAR0END: 		#0
1030++ 9DDD             
1031++ 9DDD             T1_: 			#0		
1032++ 9DDD             T_NEW_1: 		#0
1033++ 9DDD             T_OLD_1: 		#24
1034++ 9DDD             T_OLD_2: 		#24
1035++ 9DDD             T_NEW_3: 		#0
1036++ 9DDD             T_OLD_3: 		#2
1037++ 9DDD             T_OLD_0: 		#0
1038++ 9DDD             T_NEW_0: 		#24
1039++ 9DDD             T_NEW_2: 		#166
1040++ 9DDD             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;PT3 REPLAYER END
1041++ 9DDD             
1042++ 9DDD             
1043++ 9DDD             
1044++ 9DDD             
1045++ 9DDD             
1046++ 9DDD             
1047++ 9DDD             
1048++ 9DDD             
1049++ 9DDD             
1050++ 9DDD             
1051++ 9DDD             
1052++ 9DDD             
0149+  9DDD             ingame: 
0150+  9DDD             	incbin "dd.pt3"	
0151+  A014             menu: 
0152+  A014                 incbin "musicdisc.pt3"	
0153+  A2DD             final: 
0154+  A2DD                 incbin "final.pt3"		
0155+  A965             fx_player: 
0156+  A965                 include	"ayFX_player.asm"	;efectos de https://github.com/Threetwosevensixseven/ayfxedit-improved
0001++ A965             		; --- ayFX REPLAYER v1.31 ---
0002++ A965             
0003++ A965             		; --- v1.31	Fixed bug on previous version, only PSG channel C worked
0004++ A965             		; --- v1.3	Fixed volume and Relative volume versions on the same file, conditional compilation
0005++ A965             		; ---		Support for dynamic or fixed channel allocation
0006++ A965             		; --- v1.2f/r	ayFX bank support
0007++ A965             		; --- v1.11f/r	If a frame volume is zero then no AYREGS update
0008++ A965             		; --- v1.1f/r	Fixed volume for all ayFX streams
0009++ A965             		; --- v1.1	Explicit priority (as suggested by AR)
0010++ A965             		; --- v1.0f	Bug fixed (error when using noise)
0011++ A965             		; --- v1.0	Initial release
0012++ A965             
0013++ A965             		; --- DEFINE AYFXRELATIVE AS 0 FOR FIXED VOLUME VERSION ---
0014++ A965             		; --- DEFINE AYFXRELATIVE AS 1 FOR RELATIVE VOLUME VERSION ---
0015++ A965             AYFXRELATIVE equ 0
0016++ A965             
0017++ A965             ayFX_SETUP: 	; ---          ayFX replayer setup          ---
0018++ A965             		; --- INPUT: HL -> pointer to the ayFX bank ---
0019++ A965 22 41 F2    		ld	[ayFX_BANK],hl			; Current ayFX bank
0020++ A968 3E 01       		ld	a,1				; a:=0
0021++ A96A 32 40 F2    		ld	[ayFX_MODE],a			; Initial mode: fixed channel
0022++ A96D 3C          		inc	a				; Starting channel (=1)
0023++ A96E 32 4A F2    		ld	[ayFX_CHANNEL],a		; Updated
0024++ A971             ayFX_END: 	; --- End of an ayFX stream ---
0025++ A971 3E FF       		ld	a,255				; Lowest ayFX priority
0026++ A973 32 43 F2    		ld	[ayFX_PRIORITY],a		; Priority saved (not playing ayFX stream)
0027++ A976 C9          		ret					; Return
0028++ A977             
0029++ A977             ayFX_INIT: 	; ---     INIT A NEW ayFX STREAM     ---
0030++ A977             		; --- INPUT: A -> sound to be played ---
0031++ A977             		; ---        C -> sound priority     ---
0032++ A977 C5          		push	bc				; Store bc in stack
0033++ A978 D5          		push	de				; Store de in stack
0034++ A979 E5          		push	hl				; Store hl in stack
0035++ A97A             		; --- Check if the index is in the bank ---
0036++ A97A 47          		ld	b,a				; b:=a (new ayFX stream index)
0037++ A97B 2A 41 F2    		ld	hl,[ayFX_BANK]			; Current ayFX BANK
0038++ A97E 7E          		ld	a,[hl]				; Number of samples in the bank
0039++ A97F B7          		or	a				; If zero (means 256 samples)...
0040++ A980 28 06       		jr	z,.CHECK_PRI			; ...goto .CHECK_PRI
0041++ A982             		; The bank has less than 256 samples
0042++ A982 78          		ld	a,b				; a:=b (new ayFX stream index)
0043++ A983 BE          		cp	[hl]				; If new index is not in the bank...
0044++ A984 3E 02       		ld	a,2				; a:=2 (error 2: Sample not in the bank)
0045++ A986 30 21       		jr	nc,.INIT_END			; ...we can't init it
0046++ A988             .CHECK_PRI: 	; --- Check if the new priority is lower than the current one ---
0047++ A988             		; ---   Remember: 0 = highest priority, 15 = lowest priority  ---
0048++ A988 78          		ld	a,b				; a:=b (new ayFX stream index)
0049++ A989 3A 43 F2    		ld	a,[ayFX_PRIORITY]		; a:=Current ayFX stream priority
0050++ A98C B9          		cp	c				; If new ayFX stream priority is lower than current one...
0051++ A98D 3E 01       		ld	a,1				; a:=1 (error 1: A sample with higher priority is being played)
0052++ A98F 38 18       		jr	c,.INIT_END			; ...we don't start the new ayFX stream
0053++ A991             		; --- Set new priority ---
0054++ A991 79          		ld	a,c				; a:=New priority
0055++ A992 E6 0F       		and	$0F				; We mask the priority
0056++ A994 32 43 F2    		ld	[ayFX_PRIORITY],a		; new ayFX stream priority saved in RAM
0057++ A997             
0058++ A997             		IF ( AYFXRELATIVE == 1 )
0059++ A997~            			; --- Volume adjust using PT3 volume table ---
0060++ A997~            			ld	c,a				; c:=New priority (fixed)
0061++ A997~            			ld	a,15				; a:=15
0062++ A997~            			sub	c				; a:=15-New priority = relative volume
0063++ A997~            			jr	z,.INIT_NOSOUND		; If priority is 15 -> no sound output (volume is zero)
0064++ A997~            			add	a,a				; a:=a*2
0065++ A997~            			add	a,a				; a:=a*4
0066++ A997~            			add	a,a				; a:=a*8
0067++ A997~            			add	a,a				; a:=a*16
0068++ A997~            			ld	e,a				; e:=a
0069++ A997~            			ld	d,0				; de:=a
0070++ A997~            			ld	hl,VT_				; hl:=PT3 volume table
0071++ A997~            			add	hl,de				; hl is a pointer to the relative volume table
0072++ A997~            			ld	[ayFX_VT],hl			; Save pointer
0073++ A997             		ENDIF
0074++ A997             
0075++ A997             		; --- Calculate the pointer to the new ayFX stream ---
0076++ A997 ED 5B 41 F2 		ld	de,[ayFX_BANK]			; de:=Current ayFX bank
0077++ A99B 13          		inc	de				; de points to the increments table of the bank
0078++ A99C 68          		ld	l,b				; l:=b (new ayFX stream index)
0079++ A99D 26 00       		ld	h,0				; hl:=b (new ayFX stream index)
0080++ A99F 29          		add	hl,hl				; hl:=hl*2
0081++ A9A0 19          		add	hl,de				; hl:=hl+de (hl points to the correct increment)
0082++ A9A1 5E          		ld	e,[hl]				; e:=lower byte of the increment
0083++ A9A2 23          		inc	hl				; hl points to the higher byte of the correct increment
0084++ A9A3 56          		ld	d,[hl]				; de:=increment
0085++ A9A4 19          		add	hl,de				; hl:=hl+de (hl points to the new ayFX stream)
0086++ A9A5 22 44 F2    		ld	[ayFX_POINTER],hl		; Pointer saved in RAM
0087++ A9A8 AF          		xor	a				; a:=0 (no errors)
0088++ A9A9 E1          .INIT_END: 	pop	hl				; Retrieve hl from stack
0089++ A9AA D1          		pop	de				; Retrieve de from stack
0090++ A9AB C1          		pop	bc				; Retrieve bc from stack
0091++ A9AC C9          		ret					; Return
0092++ A9AD             
0093++ A9AD             		IF ( AYFXRELATIVE == 1 )
0094++ A9AD~            .INIT_NOSOUND: 	; --- Init a sample with relative volume zero -> no sound output ---
0095++ A9AD~            			ld	a,255				; Lowest ayFX priority
0096++ A9AD~            			ld	[ayFX_PRIORITY],a		; Priority saved (not playing ayFX stream)
0097++ A9AD~            			jr	.INIT_END			; Jumps to .INIT_END
0098++ A9AD             		ENDIF
0099++ A9AD             
0100++ A9AD             ayFX_PLAY: 	; --- PLAY A FRAME OF AN ayFX STREAM ---
0101++ A9AD 3A 43 F2    		ld	a,[ayFX_PRIORITY]		; a:=Current ayFX stream priority
0102++ A9B0 B7          		or	a				; If priority has bit 7 on...
0103++ A9B1 F8          		ret	m				; ...return
0104++ A9B2             		; --- Calculate next ayFX channel (if needed) ---
0105++ A9B2 3A 40 F2    		ld	a,[ayFX_MODE]			; ayFX mode
0106++ A9B5 E6 01       		and	1				; If bit0=0 (fixed channel)...
0107++ A9B7 28 08       		jr	z,.TAKECB			; ...skip channel changing
0108++ A9B9 21 4A F2    		ld	hl,ayFX_CHANNEL			; Old ayFX playing channel
0109++ A9BC 35          		dec	[hl]				; New ayFX playing channel
0110++ A9BD 20 02       		jr	nz,.TAKECB			; If not zero jump to .TAKECB
0111++ A9BF 36 03       		ld	[hl],3				; If zero -> set channel 3
0112++ A9C1             .TAKECB: 	; --- Extract control byte from stream ---
0113++ A9C1 2A 44 F2    		ld	hl,[ayFX_POINTER]		; Pointer to the current ayFX stream
0114++ A9C4 4E          		ld	c,[hl]				; c:=Control byte
0115++ A9C5 23          		inc	hl				; Increment pointer
0116++ A9C6             		; --- Check if there's new tone on stream ---
0117++ A9C6 CB 69       		bit	5,c				; If bit 5 c is off...
0118++ A9C8 28 08       		jr	z,.CHECK_NN			; ...jump to .CHECK_NN (no new tone)
0119++ A9CA             		; --- Extract new tone from stream ---
0120++ A9CA 5E          		ld	e,[hl]				; e:=lower byte of new tone
0121++ A9CB 23          		inc	hl				; Increment pointer
0122++ A9CC 56          		ld	d,[hl]				; d:=higher byte of new tone
0123++ A9CD 23          		inc	hl				; Increment pointer
0124++ A9CE ED 53 46 F2 		ld	[ayFX_TONE],de			; ayFX tone updated
0125++ A9D2             .CHECK_NN: 	; --- Check if there's new noise on stream ---
0126++ A9D2 CB 71       		bit	6,c				; if bit 6 c is off...
0127++ A9D4 28 09       		jr	z,.SETPOINTER			; ...jump to .SETPOINTER (no new noise)
0128++ A9D6             		; --- Extract new noise from stream ---
0129++ A9D6 7E          		ld	a,[hl]				; a:=New noise
0130++ A9D7 23          		inc	hl				; Increment pointer
0131++ A9D8 FE 20       		cp	$20				; If it's an illegal value of noise (used to mark end of stream)...
0132++ A9DA 28 95       		jr	z,ayFX_END			; ...jump to ayFX_END
0133++ A9DC 32 48 F2    		ld	[ayFX_NOISE],a			; ayFX noise updated
0134++ A9DF             .SETPOINTER: 	; --- Update ayFX pointer ---
0135++ A9DF 22 44 F2    		ld	[ayFX_POINTER],hl		; Update ayFX stream pointer
0136++ A9E2             		; --- Extract volume ---
0137++ A9E2 79          		ld	a,c				; a:=Control byte
0138++ A9E3 E6 0F       		and	$0F				; lower nibble
0139++ A9E5             
0140++ A9E5             		IF ( AYFXRELATIVE == 1 )
0141++ A9E5~            			; --- Fix the volume using PT3 Volume Table ---
0142++ A9E5~            			ld	hl,[ayFX_VT]			; hl:=Pointer to relative volume table
0143++ A9E5~            			ld	e,a				; e:=a (ayFX volume)
0144++ A9E5~            			ld	d,0				; d:=0
0145++ A9E5~            			add	hl,de				; hl:=hl+de (hl points to the relative volume of this frame
0146++ A9E5~            			ld	a,[hl]				; a:=ayFX relative volume
0147++ A9E5~            			or	a				; If relative volume is zero...
0148++ A9E5             		ENDIF
0149++ A9E5             
0150++ A9E5 32 49 F2    		ld	[ayFX_VOLUME],a			; ayFX volume updated
0151++ A9E8 C8          		ret	z				; ...return (don't copy ayFX values in to AYREGS)
0152++ A9E9             		; -------------------------------------
0153++ A9E9             		; --- COPY ayFX VALUES IN TO AYREGS ---
0154++ A9E9             		; -------------------------------------
0155++ A9E9             		; --- Set noise channel ---
0156++ A9E9 CB 79       		bit	7,c				; If noise is off...
0157++ A9EB 20 06       		jr	nz,.SETMASKS			; ...jump to .SETMASKS
0158++ A9ED 3A 48 F2    		ld	a,[ayFX_NOISE]			; ayFX noise value
0159++ A9F0 32 46 F1    		ld	[AYREGS+6],a			; copied in to AYREGS (noise channel)
0160++ A9F3             .SETMASKS: 	; --- Set mixer masks ---
0161++ A9F3 79          		ld	a,c				; a:=Control byte
0162++ A9F4 E6 90       		and	$90				; Only bits 7 and 4 (noise and tone mask for psg reg 7)
0163++ A9F6 FE 90       		cp	$90				; If no noise and no tone...
0164++ A9F8 C8          		ret	z				; ...return (don't copy ayFX values in to AYREGS)
0165++ A9F9             		; --- Copy ayFX values in to ARYREGS ---
0166++ A9F9 0F          		rrca					; Rotate a to the right (1 TIME)
0167++ A9FA 0F          		rrca					; Rotate a to the right (2 TIMES) (OR mask)
0168++ A9FB 16 DB       		ld	d,$DB				; d:=Mask for psg mixer (AND mask)
0169++ A9FD             		; --- Dump to correct channel ---
0170++ A9FD 21 4A F2    		ld	hl,ayFX_CHANNEL			; Next ayFX playing channel
0171++ AA00 46          		ld	b,[hl]				; Channel counter
0172++ AA01             .CHK1: 		; --- Check if playing channel was 1 ---
0173++ AA01 10 0D       		djnz	.CHK2				; Decrement and jump if channel was not 1
0174++ AA03             .PLAY_C: 	; --- Play ayFX stream on channel C ---
0175++ AA03 CD 32 AA    		call	.SETMIXER			; Set PSG mixer value (returning a=ayFX volume and hl=ayFX tone)
0176++ AA06 32 4A F1    		ld	[AYREGS+10],a			; Volume copied in to AYREGS (channel C volume)
0177++ AA09 CB 51       		bit	2,c				; If tone is off...
0178++ AA0B C0          		ret	nz				; ...return
0179++ AA0C 22 44 F1    		ld	[AYREGS+4],hl			; copied in to AYREGS (channel C tone)
0180++ AA0F C9          		ret					; Return
0181++ AA10             .CHK2: 		; --- Check if playing channel was 2 ---
0182++ AA10 CB 0A       		rrc	d				; Rotate right AND mask
0183++ AA12 0F          		rrca					; Rotate right OR mask
0184++ AA13 10 0D       		djnz	.CHK3				; Decrement and jump if channel was not 2
0185++ AA15             .PLAY_B: 	; --- Play ayFX stream on channel B ---
0186++ AA15 CD 32 AA    		call	.SETMIXER			; Set PSG mixer value (returning a=ayFX volume and hl=ayFX tone)
0187++ AA18 32 49 F1    		ld	[AYREGS+9],a			; Volume copied in to AYREGS (channel B volume)
0188++ AA1B CB 49       		bit	1,c				; If tone is off...
0189++ AA1D C0          		ret	nz				; ...return
0190++ AA1E 22 42 F1    		ld	[AYREGS+2],hl			; copied in to AYREGS (channel B tone)
0191++ AA21 C9          		ret					; Return
0192++ AA22             .CHK3: 		; --- Check if playing channel was 3 ---
0193++ AA22 CB 0A       		rrc	d				; Rotate right AND mask
0194++ AA24 0F          		rrca					; Rotate right OR mask
0195++ AA25             .PLAY_A: 	; --- Play ayFX stream on channel A ---
0196++ AA25 CD 32 AA    		call	.SETMIXER			; Set PSG mixer value (returning a=ayFX volume and hl=ayFX tone)
0197++ AA28 32 48 F1    		ld	[AYREGS+8],a			; Volume copied in to AYREGS (channel A volume)
0198++ AA2B CB 41       		bit	0,c				; If tone is off...
0199++ AA2D C0          		ret	nz				; ...return
0200++ AA2E 22 40 F1    		ld	[AYREGS+0],hl			; copied in to AYREGS (channel A tone)
0201++ AA31 C9          		ret					; Return
0202++ AA32             .SETMIXER: 	; --- Set PSG mixer value ---
0203++ AA32 4F          		ld	c,a				; c:=OR mask
0204++ AA33 3A 47 F1    		ld	a,[AYREGS+7]			; a:=PSG mixer value
0205++ AA36 A2          		and	d				; AND mask
0206++ AA37 B1          		or	c				; OR mask
0207++ AA38 32 47 F1    		ld	[AYREGS+7],a			; PSG mixer value updated
0208++ AA3B 3A 49 F2    		ld	a,[ayFX_VOLUME]			; a:=ayFX volume value
0209++ AA3E 2A 46 F2    		ld	hl,[ayFX_TONE]			; ayFX tone value
0210++ AA41 C9          		ret					; Return
0211++ AA42             
0212++ AA42             		IF ( AYFXRELATIVE == 1 )
0213++ AA42~            			; --- UNCOMMENT THIS IF YOU DON'T USE THIS REPLAYER WITH PT3 REPLAYER ---
0214++ AA42~            		;VT_:	.INCBIN	"VT.BIN"
0215++ AA42~            			; --- UNCOMMENT THIS IF YOU DON'T USE THIS REPLAYER WITH PT3 REPLAYER ---
0216++ AA42             		ENDIF
0217++ AA42             
0218++ AA42             
0219++ AA42             ;AYREGS:			#0
0220++ AA42             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ayFX REPLAYER 
0221++ AA42             ayFX_MODE: 		#1			; ayFX mode
0222++ AA42             ayFX_BANK: 		#2			; Current ayFX Bank
0223++ AA42             ayFX_PRIORITY: 	#1			; Current ayFX stream priotity
0224++ AA42             ayFX_POINTER: 	#2			; Pointer to the current ayFX stream
0225++ AA42             ayFX_TONE: 		#2			; Current tone of the ayFX stream
0226++ AA42             ayFX_NOISE: 		#1			; Current noise of the ayFX stream
0227++ AA42             ayFX_VOLUME: 	#1			; Current volume of the ayFX stream
0228++ AA42             ayFX_CHANNEL: 	#1			; PSG channel to play the ayFX stream
0229++ AA42             
0230++ AA42             	;IF (AYFXRELATIVE == 1 ) 
0231++ AA42             ;ayFX_VT:	ds	2			; ayFX relative volume table pointer
0232++ AA42             	;ENDIF
0233++ AA42             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ayFX REPLAYER END
0157+  AA42             sfx_bank: 
0158+  AA42             	incbin "sfx.afb"
0159+  AE5A             
0189   AE5A             depack_VRAM: 
0190   AE5A                 include "src/PL_VRAM_Depack.asm"
0001+  AE5A             ;-----------------------------------------------------------
0002+  AE5A             ; Pletter v0.5b VRAM Depacker v1.1 - 16Kb version
0003+  AE5A             ; HL = RAM/ROM source ; DE = VRAM destination
0004+  AE5A             ;-----------------------------------------------------------
0005+  AE5A F3          	di
0006+  AE5B             
0007+  AE5B             ; VRAM address setup
0008+  AE5B 7B          	ld	a,e
0009+  AE5C D3 99       	out	[099h],a
0010+  AE5E 7A          	ld	a,d
0011+  AE5F F6 40       	or	040h
0012+  AE61 D3 99       	out	[099h],a
0013+  AE63             
0014+  AE63             ; Initialization
0015+  AE63 7E          	ld	a,[hl]
0016+  AE64 23          	inc	hl
0017+  AE65 D9          	exx
0018+  AE66 11 00 00    	ld	de,0
0019+  AE69 87          	add	a,a
0020+  AE6A 3C          	inc	a
0021+  AE6B CB 13       	rl	e
0022+  AE6D 87          	add	a,a
0023+  AE6E CB 13       	rl	e
0024+  AE70 87          	add	a,a
0025+  AE71 CB 13       	rl	e
0026+  AE73 CB 13       	rl	e
0027+  AE75 21 2C AF    	ld	hl,modes
0028+  AE78 19          	add	hl,de
0029+  AE79 5E          	ld	e,[hl]
0030+  AE7A DD 6B       	ld	ixl,e
0031+  AE7C 23          	inc	hl
0032+  AE7D 5E          	ld	e,[hl]
0033+  AE7E DD 63       	ld	ixh,e
0034+  AE80 1E 01       	ld	e,1
0035+  AE82 D9          	exx
0036+  AE83 FD 21 8C AE 	ld	iy,loop
0037+  AE87             
0038+  AE87             ; Main depack loop
0039+  AE87 0E 98       literal: ld	c,098h
0040+  AE89 ED A3       	outi
0041+  AE8B 13          	inc	de
0042+  AE8C 87          loop: 	add	a,a
0043+  AE8D CC 20 AF      	call	z,getbit
0044+  AE90 30 F5       	jr	nc,literal
0045+  AE92             
0046+  AE92             ; Compressed data
0047+  AE92 D9          	exx
0048+  AE93 62          	ld	h,d
0049+  AE94 6B          	ld	l,e
0050+  AE95 87          getlen:  add	a,a
0051+  AE96 CC 24 AF    	call	z,getbitexx
0052+  AE99 30 1D       	jr	nc,lenok
0053+  AE9B 87          lus: 	add	a,a
0054+  AE9C CC 24 AF    	call	z,getbitexx
0055+  AE9F ED 6A       	adc	hl,hl
0056+  AEA1 D8          	ret	c
0057+  AEA2 87          	add	a,a
0058+  AEA3 CC 24 AF    	call	z,getbitexx
0059+  AEA6 30 10       	jr	nc,lenok
0060+  AEA8 87          	add	a,a
0061+  AEA9 CC 24 AF    	call	z,getbitexx
0062+  AEAC ED 6A       	adc	hl,hl
0063+  AEAE DA 2A AF    	jp	c,Depack_out
0064+  AEB1 87          	add	a,a
0065+  AEB2 CC 24 AF    	call	z,getbitexx
0066+  AEB5 DA 9B AE    	jp	c,lus
0067+  AEB8 23          lenok:   inc	hl
0068+  AEB9 D9          	exx
0069+  AEBA 4E          	ld	c,[hl]
0070+  AEBB 23          	inc	hl
0071+  AEBC 06 00       	ld	b,0
0072+  AEBE CB 79       	bit	7,c
0073+  AEC0 CA F3 AE    	jp	z,offsok
0074+  AEC3 DD E9       	jp	ix
0075+  AEC5             
0076+  AEC5 87          mode7:   add	a,a
0077+  AEC6 CC 20 AF      	call	z,getbit
0078+  AEC9 CB 10       	rl	b
0079+  AECB 87          mode6: 	add	a,a
0080+  AECC CC 20 AF      	call	z,getbit
0081+  AECF CB 10       	rl	b
0082+  AED1 87          mode5:   add	a,a
0083+  AED2 CC 20 AF      	call	z,getbit
0084+  AED5 CB 10       	rl	b
0085+  AED7 87          mode4:   add	a,a
0086+  AED8 CC 20 AF      	call	z,getbit
0087+  AEDB CB 10       	rl	b
0088+  AEDD 87          mode3:   add	a,a
0089+  AEDE CC 20 AF      	call	z,getbit
0090+  AEE1 CB 10       	rl	b
0091+  AEE3 87          mode2: 	add	a,a
0092+  AEE4 CC 20 AF      	call	z,getbit
0093+  AEE7 CB 10       	rl	b
0094+  AEE9 87          	add	a,a
0095+  AEEA CC 20 AF      	call	z,getbit
0096+  AEED 30 04       	jr	nc,offsok
0097+  AEEF B7          	or	a
0098+  AEF0 04          	inc	b
0099+  AEF1 CB B9       	res	7,c
0100+  AEF3 03          offsok:  inc	bc
0101+  AEF4 E5          	push	hl
0102+  AEF5 D9          	exx
0103+  AEF6 E5          	push	hl
0104+  AEF7 D9          	exx
0105+  AEF8 6B          	ld	l,e
0106+  AEF9 62          	ld	h,d
0107+  AEFA ED 42       	sbc	hl,bc
0108+  AEFC C1          	pop	bc
0109+  AEFD F5          	push	af
0110+  AEFE 7D          .loop: 	ld	a,l
0111+  AEFF D3 99       	out	[099h],a
0112+  AF01 7C          	ld	a,h
0113+  AF02 00          	nop                     ; VDP timing
0114+  AF03 D3 99       	out	[099h],a
0115+  AF05 00          	nop                     ; VDP timing
0116+  AF06 DB 98       	in	a,[098h]
0117+  AF08 08          	ex	af,af'
0118+  AF09 7B          	ld	a,e
0119+  AF0A 00          	nop			; VDP timing
0120+  AF0B D3 99       	out	[099h],a
0121+  AF0D 7A          	ld	a,d
0122+  AF0E F6 40       	or	040h
0123+  AF10 D3 99       	out	[099h],a
0124+  AF12 08          	ex	af,af'
0125+  AF13 00          	nop			; VDP timing
0126+  AF14 D3 98       	out	[098h],a
0127+  AF16 13          	inc	de
0128+  AF17 ED A1       	cpi
0129+  AF19 EA FE AE    	jp	pe,.loop
0130+  AF1C F1          	pop	af
0131+  AF1D E1          	pop	hl
0132+  AF1E FD E9       	jp	iy
0133+  AF20             
0134+  AF20 7E          getbit:  ld	a,[hl]
0135+  AF21 23          	inc	hl
0136+  AF22 17          	rla
0137+  AF23 C9          	ret
0138+  AF24             
0139+  AF24             getbitexx: 
0140+  AF24 D9          	exx
0141+  AF25 7E          	ld	a,[hl]
0142+  AF26 23          	inc	hl
0143+  AF27 D9          	exx
0144+  AF28 17          	rla
0145+  AF29 C9          	ret
0146+  AF2A             
0147+  AF2A             ; Depacker exit
0148+  AF2A             Depack_out: 
0149+  AF2A FB          	ei
0150+  AF2B C9          	ret
0151+  AF2C             
0152+  AF2C             modes: 
0153+  AF2C F3 AE       	dw	offsok
0154+  AF2E E3 AE       	dw	mode2
0155+  AF30 DD AE       	dw	mode3
0156+  AF32 D7 AE       	dw	mode4
0157+  AF34 D1 AE       	dw	mode5
0158+  AF36 CB AE       	dw	mode6
0159+  AF38 C5 AE       	dw	mode7
0191   AF3A             loader_screen: 
0192   AF3A                 incbin "./assets/DISCOIM.S02.plet5";creado con pletter5b.exe
0193   CF2B             
0194   CF2B             
0195   CF2B             FINAL: 
