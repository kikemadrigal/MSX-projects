10rem******************************
20remProgram:Laberinto
30remautor:MSXMurcia
40rem******************************
45print"Ejecutandoinstrucciones"
50definta-z:DEFUSR1=&H41:DEFUSR2=&H44
60'ONSTRIGGOSUB1530
70'spriteon:ONSPRITEGOSUB2000
80gosub8000
90gosub8100
100gosub8500
120gosub5000
130gosub6000
140gosub6100:ex(1)=8*12:ey(1)=6*20:ev(1)=8:es(1)=4
150gosub6100:ex(2)=8*18:ey(2)=8*6:ev(2)=8:es(2)=4
160gosub6100:ex(3)=8*14:ey(3)=8*8:ev(3)=8:es(3)=6
170'gosub6100:ex(4)=8*30:ey(4)=8*10:el(4)=8:es(3)=6
400gosub1260
430gosub1760
440gosub1400
450gosub1900
500goto400
1260''<<<<INPUTSYSTEM>>>>
1265'nada'
1270ST=STICK(0)ORSTICK(1)ORSTICK(2)
1280'TG=STRIG(0)ORSTRIG(1)ORSTRIG(2)
1300xp=x:yp=y
1320IFST=7THENx=x-pv:pp=3
1330IFST=3THENx=x+pv:pp=2
1340IFST=1THENy=y-pv:pp=0
1350IFST=5THENy=y+pv:pp=1
1370ifx<=0thenx=xp
1380ify<=0theny=yp
1385ify+ph>192theny=yp
1390ifx+pw>252thenx=xp
1395RETURN
1400''<<<RENDERSYSTEM>>>>
1420PUTSPRITE0,(x,y),1,pp
1430fori=1toen-1
1440es(i)=es(i)+1
1450ifes(i)>5andi=1thenes(i)=4
1460ifes(i)>5andi=2thenes(i)=4
1470ifes(i)>7andi=3thenes(i)=6
1480ifes(i)>7andi=4thenes(i)=6
1490PUTSPRITE4+i,(ex(i),ey(i)),10,es(i)
1495nexti
1500ifms>5thenmw=mw+1:ms=0:mc=1:gosub8100
1510ifmcthengosub8500
1520return
1760hl=base(5)+(y/8)*32+(x/8):a=vpeek(hl)
1770ifa=224thenx=xp:y=yp
1780ifa=204thenx=8*16:y=8*18:beep
1790ifa=215thenmc=1:ms=ms+1
1800ifpc=1thenpc=0:spriteon
1810fori=0toen-1
1820hl=base(5)+(ey(i)/8)*32+(ex(i)/8):a=vpeek(hl)
1830ifa=224thenev(i)=-ev(i):el(i)=-el(i):ex(i)=ep(i):ey(i)=ei(i)
1840ep(i)=ex(i):ei(i)=ey(i)
1860nexti
1870return
1900fori=0toen-1
1910ex(i)=ex(i)+ev(i):ey(i)=ey(i)+el(i)
1920nexti
1930return
2000'ifpe=0thengosub5000
2010spriteoff:pe=pe-1:gosub3000:beep:gosub5100:pc=1
2090return
3000locate0,0:print"Level"mw"-"ms"v:"pe""ti
3010'locate0,23:print"MEMSIZ:"peek(&hF672)",free:"fre(0)
3020'locate0,21:print"x"x"y"y
3030return
5000x=8:y=16:xp=0:yp=0:pw=8:ph=8:pv=8:pe=10:pc=0
5020return
5100ifms=0thenx=8:y=16
5110ifms=1thenx=21:y=16
5190return
6000en=1
6020ex(0)=0:ey(0)=0:ep(0)=0:ei(0)=0
6030ev(0)=0:el(0)=0
6040ew(0)=8:eh(0)=8:es(0)=5
6050ee(0)=100
6060return
6100ex(en)=ex(0):ey(en)=ey(0):ep(en)=ep(0):ei(0)=ei(0)
6120ev(en)=ev(0):el(en)=el(0)
6130ew(en)=ew(0):eh(en)=eh(0):es(en)=es(0)
6140ee(en)=ee(0)
6150en=en+1
6160return
5100ifms=0thenx=8:y=16
5110ifms=1thenx=21:y=16
5190return
8000mw=0:ms=0:mm=6:mc=0:tn=0
8010dimm(23,31,mm-1)
8020return
8100md=&hc001:locate0,0:print"Cargandomundo..."
8110ifmw=0thenbload"word0.bin",r
8120ifmw=1thenbload"word1.bin",r
8130fori=0tomm-1
8140forf=0to21
8150forc=0to31
8160m(f,c,i)=peek(md):md=md+1
8170nextc
8180nextf
8190nexti
8200return
8500cls:mc=0
8505a=usr1(0)
8510locate0,0:print"Cargandonivel"
8520_TURBOON(tn,m(),ms,mm)
8530fori=0tomm-1
8540forf=0to21
8550forc=0to31
8560'ms=0
8560tn=m(f,c,ms)
8565'printtn;
8570iftn=1thenlocatec,f:printchr$(224)
8580iftn=2thenlocatec,f:printchr$(204)
8590iftn=3thenlocatec,f:printchr$(215)
8600nextc
8610nextf
8620nexti
8630_TURBOoff
8635a=usr2(0)
8640gosub3000
8650return
